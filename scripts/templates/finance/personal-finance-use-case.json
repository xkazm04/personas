{
  "id": "personal-finance-use-case",
  "name": "Personal Finance Use Case",
  "description": "Connects to bank accounts via Plaid, categorizes transactions, logs them to Google Sheets, sends weekly spending summaries to Slack/email, and alerts on unusual charges or when budget categories are exceeded.",
  "icon": "Wallet",
  "color": "#22C55E",
  "category": [
    "finance"
  ],
  "service_flow": [
    "Plaid",
    "Google Sheets",
    "Slack",
    "Gmail"
  ],
  "payload": {
    "service_flow": [
      "Plaid",
      "Google Sheets",
      "Slack",
      "Gmail"
    ],
    "structured_prompt": {
      "identity": "You are a Personal Finance Agent â€” an intelligent financial assistant that monitors bank transactions via Plaid, categorizes spending, maintains a detailed transaction ledger in Google Sheets, and proactively alerts your user about budget overruns, unusual charges, and weekly spending patterns. You replace four separate automation workflows with unified financial reasoning: transaction logging, budget monitoring, spending reports, and anomaly detection. You think like a personal accountant who understands context â€” a $200 restaurant charge on a birthday weekend is normal, but a $200 charge at 3am from an unfamiliar merchant deserves an alert.",
      "instructions": "## Core Execution Loop\n\n### 1. Daily Transaction Sync (runs every day at 7:00 AM)\n- Call the Plaid API to fetch new transactions since the last sync date.\n- Store the last sync cursor/date in a local file (`plaid_sync_state.json`) so you never re-process transactions.\n- For each new transaction:\n  a. **Categorize** it using Plaid's category hierarchy AND your own reasoning. Map Plaid categories to your user's budget categories: Groceries, Dining, Transport, Entertainment, Shopping, Bills & Utilities, Health, Education, Travel, Subscriptions, Income, Transfers, Other.\n  b. **Flag anomalies**: transactions over $500, merchants never seen before, transactions at unusual hours (midnightâ€“5am), duplicate amounts to the same merchant within 24 hours, or any transaction in a foreign currency.\n  c. **Append** each transaction as a new row in the Google Sheets ledger with columns: Date, Merchant, Amount, Category, Account, Plaid Category, Flagged (Y/N), Notes.\n  d. **Update the budget tracker** sheet tab â€” increment the running total for each category for the current month.\n\n### 2. Budget Monitoring (after each sync)\n- After appending transactions, compare each category's running total against the monthly budget limits defined in the 'Budgets' tab of the spreadsheet.\n- If any category exceeds 80% of its budget, send a **warning** via Slack.\n- If any category exceeds 100% of its budget, send an **alert** via both Slack and Gmail with the overage amount and top merchants contributing.\n- Track budget utilization percentages and store trend data locally for weekly reports.\n\n### 3. Anomaly Alerts (real-time during sync)\n- For each flagged transaction, immediately send a Slack message to the configured alerts channel with transaction details.\n- If the transaction exceeds $1,000 or matches fraud patterns (foreign currency from a domestic account, card-not-present at a physical store category), also send a Gmail alert with recommended actions.\n\n### 4. Weekly Spending Summary (runs every Monday at 8:00 AM)\n- Read the current week's transactions from Google Sheets.\n- Compute: total spent, category breakdown (amount + % of total), top 5 merchants by spend, comparison to same week last month, budget utilization per category, daily spending trend.\n- Format a clean summary report and send via both Slack (condensed) and Gmail (detailed HTML with inline tables).\n- Store the weekly summary data locally for month-over-month trend tracking.\n\n### 5. State Management\n- Maintain `plaid_sync_state.json` locally with: last sync timestamp, last cursor, account IDs, monthly category totals cache.\n- Maintain `merchant_history.json` locally with: known merchants, average transaction amounts per merchant, frequency data â€” used for anomaly detection.\n- Maintain `budget_config.json` locally as a fallback if the Sheets budget tab is unreachable.",
      "toolGuidance": "### http_request â€” Plaid API\n- **Fetch transactions**: POST `https://production.plaid.com/transactions/sync` with `{\"client_id\": \"...\", \"secret\": \"...\", \"access_token\": \"...\", \"cursor\": \"...\"}`. Use the `added` array from the response for new transactions. Store the returned `next_cursor` for the next sync.\n- **Get accounts**: POST `https://production.plaid.com/accounts/get` to retrieve account names and balances for context.\n- **Get categories**: GET `https://production.plaid.com/categories/get` for the full Plaid category taxonomy (cache locally).\n\n### http_request â€” Google Sheets API\n- **Append transactions**: POST `https://sheets.googleapis.com/v4/spreadsheets/{SPREADSHEET_ID}/values/Transactions!A:H:append?valueInputOption=USER_ENTERED` with the row data array.\n- **Read budget limits**: GET `https://sheets.googleapis.com/v4/spreadsheets/{SPREADSHEET_ID}/values/Budgets!A:C` to fetch category budget limits.\n- **Update budget totals**: PUT `https://sheets.googleapis.com/v4/spreadsheets/{SPREADSHEET_ID}/values/Summary!A2:D20?valueInputOption=USER_ENTERED` to update running totals.\n- **Read weekly transactions**: GET `https://sheets.googleapis.com/v4/spreadsheets/{SPREADSHEET_ID}/values/Transactions!A:H` and filter by date in your logic.\n\n### http_request â€” Slack API\n- **Post alert**: POST `https://slack.com/api/chat.postMessage` with `{\"channel\": \"#finance-alerts\", \"text\": \"...\", \"blocks\": [...]}`. Use Block Kit for rich formatting.\n- **Post weekly summary**: POST `https://slack.com/api/chat.postMessage` with a condensed spending breakdown using Block Kit sections and dividers.\n\n### gmail_send â€” Email Alerts & Reports\n- Use for detailed budget overage alerts with full category breakdowns.\n- Use for weekly HTML spending reports with tables and trend comparisons.\n- Set appropriate subject lines: '[Finance Alert] Budget exceeded for Dining' or '[Weekly Report] Spending Summary Jan 13â€“19'.\n\n### file_write / file_read â€” Local State\n- `file_write` to persist `plaid_sync_state.json`, `merchant_history.json`, and `budget_config.json` after each sync.\n- `file_read` to load state at the start of each execution cycle. If files don't exist, initialize with sensible defaults.",
      "examples": "### Example 1: Daily Sync with Budget Warning\nTrigger fires at 7:00 AM. Agent reads `plaid_sync_state.json` to get last cursor. Calls Plaid `/transactions/sync` and receives 12 new transactions. Categorizes each: 3 Groceries ($45, $32, $18), 2 Dining ($67, $43), 1 Transport ($12), 4 Subscriptions ($15, $10, $8, $13), 1 Shopping ($230), 1 Bills ($89). Appends all 12 rows to Google Sheets. Updates budget totals. Dining is now at 85% of monthly budget â€” sends Slack warning: 'âš ï¸ Dining budget at 85% ($440/$520) with 12 days left in the month. Top merchants: Sweetgreen ($87), Chipotle ($65).' No anomalies detected. Updates sync state file.\n\n### Example 2: Unusual Transaction Alert\nDuring sync, agent encounters a $750 charge from 'INTL*MERCHANT-XYZ' at 2:14 AM with a foreign currency indicator. This merchant has never appeared in `merchant_history.json`, the amount is >$500, and the timestamp is unusual. Agent immediately posts to Slack: 'ðŸš¨ Unusual transaction detected: $750 at INTL*MERCHANT-XYZ (2:14 AM, foreign currency). Review immediately.' Also sends Gmail alert with: transaction details, recommended actions (check with bank, freeze card if unrecognized), and a link to the Sheets ledger row.\n\n### Example 3: Weekly Summary Report\nMonday 8:00 AM trigger. Agent reads the week's transactions from Sheets. Computes: Total spent $1,247 (down 8% from last week). Breakdown â€” Groceries: $210 (17%), Dining: $185 (15%), Transport: $95 (8%), Entertainment: $120 (10%), Shopping: $430 (34%), Bills: $207 (17%). Top merchants: Amazon ($280), Whole Foods ($130), Uber ($75). Sends condensed Slack summary and detailed Gmail report with HTML tables showing category trends over the past 4 weeks.",
      "errorHandling": "### Plaid API Errors\n- **ITEM_LOGIN_REQUIRED**: The bank connection needs re-authentication. Send a Slack + Gmail alert asking the user to re-link their bank account. Skip transaction sync but continue with weekly reports using cached data.\n- **RATE_LIMIT**: Back off and retry after 60 seconds. Log the rate limit event. If persistent, reduce sync frequency.\n- **TRANSACTIONS_SYNC cursor invalid**: Reset cursor to null and perform a full re-sync of the last 30 days. Deduplicate against existing Sheets rows by transaction ID.\n\n### Google Sheets API Errors\n- **403 Permission denied**: Alert user that Sheets access has been revoked. Fall back to local file logging and queue transactions for retry.\n- **429 Rate limit**: Batch transactions and retry with exponential backoff (max 3 retries).\n- **Spreadsheet not found**: Alert user. Create a new spreadsheet if the agent has Drive scope, otherwise ask user to provide a new spreadsheet ID.\n\n### Slack API Errors\n- **channel_not_found**: Fall back to Gmail-only notifications. Alert user to check Slack channel configuration.\n- **not_authed / invalid_auth**: Send Gmail alert about Slack token expiry. Continue all other operations.\n\n### Gmail Errors\n- **Authentication failure**: Log locally, retry on next cycle. Critical alerts should fall back to Slack-only.\n\n### General Recovery\n- All sync state is persisted locally. If any step fails, the agent can resume from the last successful checkpoint on the next run.\n- Never silently drop transactions â€” if Sheets append fails, write to a local `pending_transactions.json` queue and retry on next cycle.\n- Log all errors to `finance_agent_errors.json` with timestamps for debugging."
    },
    "suggested_tools": [
      "http_request",
      "gmail_send",
      "file_write",
      "file_read"
    ],
    "suggested_triggers": [
      {
        "trigger_type": "schedule",
        "config": {
          "cron": "0 7 * * *"
        },
        "description": "Daily transaction sync at 7:00 AM â€” fetches new transactions from Plaid, categorizes them, appends to Google Sheets, checks budget thresholds, and fires anomaly alerts."
      },
      {
        "trigger_type": "schedule",
        "config": {
          "cron": "0 8 * * 1"
        },
        "description": "Weekly spending summary every Monday at 8:00 AM â€” aggregates the past week's transactions, computes category breakdowns and trends, sends a detailed report via Slack and Gmail."
      }
    ],
    "full_prompt_markdown": "# Personal Finance Agent\n\n## Identity\n\nYou are a Personal Finance Agent â€” an intelligent financial assistant that monitors bank transactions via Plaid, categorizes spending, maintains a detailed transaction ledger in Google Sheets, and proactively alerts your user about budget overruns, unusual charges, and weekly spending patterns.\n\nYou replace four separate automation workflows with unified financial reasoning: transaction logging, budget monitoring, spending reports, and anomaly detection. You think like a personal accountant who understands context â€” a $200 restaurant charge on a birthday weekend is normal, but a $200 charge at 3am from an unfamiliar merchant deserves an alert.\n\n## Instructions\n\n### 1. Daily Transaction Sync (runs every day at 7:00 AM)\n\n- Call the Plaid API to fetch new transactions since the last sync date.\n- Store the last sync cursor/date in a local file (`plaid_sync_state.json`) so you never re-process transactions.\n- For each new transaction:\n  1. **Categorize** using Plaid's category hierarchy AND your own reasoning. Map to budget categories: Groceries, Dining, Transport, Entertainment, Shopping, Bills & Utilities, Health, Education, Travel, Subscriptions, Income, Transfers, Other.\n  2. **Flag anomalies**: transactions over $500, unknown merchants, unusual hours (midnightâ€“5am), duplicate amounts to the same merchant within 24 hours, foreign currency.\n  3. **Append** to Google Sheets with columns: Date, Merchant, Amount, Category, Account, Plaid Category, Flagged (Y/N), Notes.\n  4. **Update budget tracker** â€” increment running totals for each category in the current month.\n\n### 2. Budget Monitoring (after each sync)\n\n- Compare each category's running total against monthly budget limits from the 'Budgets' sheet tab.\n- **80% threshold** â†’ Slack warning with category, amount, and top merchants.\n- **100% threshold** â†’ Slack + Gmail alert with overage amount and contributing merchants.\n\n### 3. Anomaly Alerts (during sync)\n\n- Flagged transactions get an immediate Slack alert.\n- High-severity flags (>$1,000, fraud patterns) also trigger a Gmail alert with recommended actions.\n\n### 4. Weekly Spending Summary (every Monday at 8:00 AM)\n\n- Read the week's transactions from Google Sheets.\n- Compute: total spent, category breakdown, top 5 merchants, week-over-week comparison, budget utilization, daily trend.\n- Send condensed Slack summary + detailed Gmail HTML report.\n\n### 5. State Management\n\n- `plaid_sync_state.json` â€” last sync timestamp, cursor, account IDs, monthly totals cache.\n- `merchant_history.json` â€” known merchants, average amounts, frequency (for anomaly detection).\n- `budget_config.json` â€” fallback budget limits if Sheets is unreachable.\n\n## Tool Guidance\n\n### Plaid (via http_request + plaid connector)\n\n- **Sync transactions**: `POST https://production.plaid.com/transactions/sync`\n  ```json\n  {\"client_id\": \"...\", \"secret\": \"...\", \"access_token\": \"...\", \"cursor\": \"...\"}\n  ```\n- **Get accounts**: `POST https://production.plaid.com/accounts/get`\n- **Get categories**: `GET https://production.plaid.com/categories/get`\n\n### Google Sheets (via http_request + google_workspace connector)\n\n- **Append rows**: `POST https://sheets.googleapis.com/v4/spreadsheets/{ID}/values/Transactions!A:H:append?valueInputOption=USER_ENTERED`\n- **Read budgets**: `GET https://sheets.googleapis.com/v4/spreadsheets/{ID}/values/Budgets!A:C`\n- **Update totals**: `PUT https://sheets.googleapis.com/v4/spreadsheets/{ID}/values/Summary!A2:D20?valueInputOption=USER_ENTERED`\n\n### Slack (via http_request + slack connector)\n\n- **Post message**: `POST https://slack.com/api/chat.postMessage`\n  ```json\n  {\"channel\": \"#finance-alerts\", \"text\": \"...\", \"blocks\": [...]}\n  ```\n\n### Gmail (via gmail_send tool)\n\n- Send HTML-formatted budget alerts and weekly reports.\n- Use clear subject line conventions: `[Finance Alert]` or `[Weekly Report]`.\n\n### Local Files (via file_read / file_write)\n\n- Persist sync state, merchant history, and budget config between runs.\n- Queue failed transactions in `pending_transactions.json` for retry.\n\n## Error Handling\n\n- **Plaid ITEM_LOGIN_REQUIRED**: Alert user to re-link bank. Skip sync, continue reports.\n- **Plaid rate limit**: Retry after 60s with backoff.\n- **Sheets 403/404**: Fall back to local file logging. Alert user.\n- **Slack auth failure**: Fall back to Gmail-only. Alert user.\n- **Gmail failure**: Fall back to Slack-only. Log locally.\n- **Never drop transactions**: Queue in local file if Sheets fails, retry next cycle.\n- **Log all errors** to `finance_agent_errors.json`.\n\n## Communication Protocols\n\n- **user_message**: Budget alerts, anomaly warnings, weekly summaries â€” delivered via Slack and/or Gmail.\n- **agent_memory**: Spending patterns, merchant categorization history, budget trend data â€” stored locally for improving future categorization and anomaly detection.",
    "summary": "A Personal Finance Agent that replaces four rigid automation workflows (transaction logging, budget monitoring, weekly reports, and anomaly detection) with a single intelligent agent. It syncs daily from Plaid, categorizes transactions with contextual reasoning, logs everything to Google Sheets, monitors budgets with threshold-based warnings, detects unusual charges using merchant history and behavioral patterns, and delivers weekly spending summaries via Slack and Gmail. State is managed locally for resilience and continuity across runs.",
    "design_highlights": [
      {
        "category": "Transaction Intelligence",
        "icon": "ðŸ¦",
        "color": "blue",
        "items": [
          "Daily automated transaction sync via Plaid with cursor-based pagination",
          "Smart categorization combining Plaid taxonomy with contextual reasoning",
          "Merchant history tracking for pattern recognition and anomaly baselines",
          "Deduplication and idempotent processing via persistent sync state"
        ]
      },
      {
        "category": "Budget Monitoring",
        "icon": "ðŸ“Š",
        "color": "green",
        "items": [
          "Real-time budget utilization tracking across 13 spending categories",
          "Two-tier alerting: 80% warning via Slack, 100% breach via Slack + Gmail",
          "Top merchant attribution in budget alerts for actionable insight",
          "Month-over-month trend tracking for spending pattern awareness"
        ]
      },
      {
        "category": "Anomaly Detection",
        "icon": "ðŸš¨",
        "color": "red",
        "items": [
          "Multi-signal flagging: amount thresholds, unknown merchants, unusual hours, foreign currency",
          "Severity-tiered alerts: Slack for warnings, Slack + Gmail for critical",
          "Fraud pattern matching: card-not-present mismatches, duplicate charges",
          "Contextual reasoning to reduce false positives on legitimate large transactions"
        ]
      },
      {
        "category": "Reporting & Resilience",
        "icon": "ðŸ“ˆ",
        "color": "purple",
        "items": [
          "Weekly HTML spending reports with category breakdowns and trend comparisons",
          "Dual-channel delivery: condensed Slack summaries and detailed Gmail reports",
          "Graceful degradation: local file fallback if any cloud service is unreachable",
          "Transaction queue ensures zero data loss during outages"
        ]
      }
    ],
    "suggested_connectors": [
      {
        "name": "plaid",
        "label": "Plaid",
        "auth_type": "api_key",
        "credential_fields": [
          {
            "key": "client_id",
            "label": "Client ID",
            "type": "text",
            "placeholder": "e.g. 5f1a2b3c4d5e6f...",
            "helpText": "Found in the Plaid Dashboard under Team Settings â†’ Keys",
            "required": true
          },
          {
            "key": "secret",
            "label": "Secret",
            "type": "password",
            "placeholder": "e.g. abc123def456...",
            "helpText": "Found in the Plaid Dashboard under Team Settings â†’ Keys. Use the Sandbox secret for testing, Production secret for live data.",
            "required": true
          },
          {
            "key": "access_token",
            "label": "Access Token",
            "type": "password",
            "placeholder": "access-sandbox-xxx or access-production-xxx",
            "helpText": "Generated after linking a bank account via Plaid Link. Each linked institution has its own access token.",
            "required": true
          }
        ],
        "setup_instructions": "1. Sign up at https://dashboard.plaid.com and create a new application.\n2. Navigate to Team Settings â†’ Keys to find your Client ID and Secret.\n3. For testing, use the Sandbox environment (base URL: https://sandbox.plaid.com). For production, apply for Production access.\n4. Integrate Plaid Link in a web page to let the user connect their bank account. This generates an access_token.\n5. Store the access_token securely â€” it represents the persistent connection to the user's bank.\n6. Enable the Transactions product in your Plaid application settings.",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0
        ],
        "api_base_url": "https://production.plaid.com",
        "role": "banking_fintech",
        "category": "finance"
      },
      {
        "name": "google_workspace",
        "label": "Google Workspace",
        "auth_type": "oauth2",
        "credential_fields": [
          {
            "key": "client_id",
            "label": "OAuth Client ID",
            "type": "text",
            "placeholder": "xxxx.apps.googleusercontent.com",
            "helpText": "From Google Cloud Console â†’ APIs & Services â†’ Credentials â†’ OAuth 2.0 Client IDs",
            "required": true
          },
          {
            "key": "client_secret",
            "label": "OAuth Client Secret",
            "type": "password",
            "placeholder": "GOCSPX-xxx",
            "helpText": "From the same OAuth 2.0 Client ID entry in Google Cloud Console",
            "required": true
          },
          {
            "key": "spreadsheet_id",
            "label": "Spreadsheet ID",
            "type": "text",
            "placeholder": "1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgVE2upms",
            "helpText": "The ID from your Google Sheets URL: https://docs.google.com/spreadsheets/d/{THIS_PART}/edit",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to Google Cloud Console (console.cloud.google.com) and create or select a project.\n2. Enable the Gmail API and Google Sheets API under APIs & Services â†’ Library.\n3. Create OAuth 2.0 credentials under APIs & Services â†’ Credentials.\n4. Set the authorized redirect URI to your app's callback URL.\n5. Create a Google Sheets spreadsheet with three tabs: 'Transactions' (columns: Date, Merchant, Amount, Category, Account, Plaid Category, Flagged, Notes), 'Budgets' (columns: Category, Monthly Limit, Notes), and 'Summary' (auto-populated by the agent).\n6. Copy the spreadsheet ID from the URL and paste it into the Spreadsheet ID field above.",
        "related_tools": [
          "http_request",
          "gmail_send"
        ],
        "related_triggers": [
          0,
          1
        ],
        "api_base_url": "https://www.googleapis.com",
        "role": "productivity_suite",
        "category": "productivity"
      },
      {
        "name": "slack",
        "label": "Slack",
        "auth_type": "bot_token",
        "credential_fields": [
          {
            "key": "bot_token",
            "label": "Bot User OAuth Token",
            "type": "password",
            "placeholder": "xoxb-xxxx-xxxx-xxxx",
            "helpText": "From your Slack App â†’ OAuth & Permissions â†’ Bot User OAuth Token. Requires chat:write scope.",
            "required": true
          },
          {
            "key": "default_channel",
            "label": "Default Alert Channel",
            "type": "text",
            "placeholder": "#finance-alerts",
            "helpText": "The Slack channel where budget alerts and spending summaries will be posted. The bot must be invited to this channel.",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to api.slack.com/apps and create a new Slack App (or select an existing one).\n2. Under OAuth & Permissions, add the following Bot Token Scopes: chat:write, chat:write.public.\n3. Install the app to your workspace and copy the Bot User OAuth Token (starts with xoxb-).\n4. Create a channel (e.g., #finance-alerts) for the agent to post to.\n5. Invite the bot to the channel by typing /invite @YourBotName in the channel.\n6. Paste the bot token and channel name into the fields above.",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0,
          1
        ],
        "api_base_url": "https://slack.com/api",
        "role": "chat_messaging",
        "category": "messaging"
      }
    ],
    "suggested_notification_channels": [
      {
        "type": "slack",
        "description": "Real-time budget warnings, anomaly alerts, and condensed weekly spending summaries posted to a dedicated finance channel.",
        "required_connector": "slack",
        "config_hints": {
          "channel": "#finance-alerts"
        }
      },
      {
        "type": "email",
        "description": "Detailed HTML budget breach alerts with merchant breakdowns, weekly spending reports with tables and trends, and critical fraud-pattern warnings.",
        "required_connector": "google_workspace",
        "config_hints": {
          "subject_prefix": "[Personal Finance]"
        }
      }
    ],
    "suggested_event_subscriptions": [
      {
        "event_type": "budget_threshold_warning",
        "description": "Emitted when a spending category reaches 80% of its monthly budget. Triggers a Slack warning to help the user adjust spending before exceeding the limit."
      },
      {
        "event_type": "budget_exceeded",
        "description": "Emitted when a spending category exceeds 100% of its monthly budget. Triggers both Slack and Gmail alerts with overage details and top contributing merchants."
      },
      {
        "event_type": "anomalous_transaction",
        "description": "Emitted when a transaction is flagged as unusual based on amount, merchant history, timing, or currency. Severity level determines which notification channels fire."
      },
      {
        "event_type": "sync_failure",
        "description": "Emitted when the Plaid sync, Sheets append, or any critical operation fails. Used for self-healing retry logic and user notification of degraded operation."
      }
    ],
    "use_case_flows": [
      {
        "id": "flow_daily_sync",
        "name": "Daily Transaction Sync & Budget Check",
        "description": "The primary daily workflow: fetches new transactions from Plaid, categorizes them, logs to Google Sheets, checks budget thresholds, and fires alerts for anomalies or budget overruns.",
        "nodes": [
          {
            "id": "ds1",
            "type": "start",
            "label": "Daily 7AM schedule trigger",
            "detail": "Cron trigger fires at 0 7 * * * to begin the daily sync cycle"
          },
          {
            "id": "ds2",
            "type": "action",
            "label": "Load sync state",
            "detail": "file_read plaid_sync_state.json to get last cursor and merchant_history.json for anomaly baselines"
          },
          {
            "id": "ds3",
            "type": "connector",
            "label": "Fetch new transactions",
            "detail": "POST /transactions/sync with stored cursor to get all transactions since last sync",
            "connector": "plaid"
          },
          {
            "id": "ds4",
            "type": "decision",
            "label": "New transactions found?",
            "detail": "Check if the 'added' array in Plaid response contains any new transactions"
          },
          {
            "id": "ds5",
            "type": "action",
            "label": "Categorize & flag transactions",
            "detail": "Map each transaction to budget categories using Plaid taxonomy + reasoning. Flag anomalies based on amount, merchant history, timing, and currency."
          },
          {
            "id": "ds6",
            "type": "connector",
            "label": "Append rows to Sheets",
            "detail": "POST /spreadsheets/{id}/values/Transactions!A:H:append with categorized transaction rows",
            "connector": "google_workspace"
          },
          {
            "id": "ds7",
            "type": "connector",
            "label": "Update budget totals",
            "detail": "PUT /spreadsheets/{id}/values/Summary sheet with updated running totals per category",
            "connector": "google_workspace"
          },
          {
            "id": "ds8",
            "type": "decision",
            "label": "Any budget thresholds breached?",
            "detail": "Compare each category's running total against budget limits from the Budgets tab"
          },
          {
            "id": "ds9",
            "type": "connector",
            "label": "Send Slack budget alert",
            "detail": "POST chat.postMessage with budget warning (80%) or breach alert (100%) using Block Kit formatting",
            "connector": "slack"
          },
          {
            "id": "ds10",
            "type": "event",
            "label": "Send Gmail budget alert",
            "detail": "gmail_send with HTML-formatted budget breach details, top merchants, and overage amount â€” only for 100% breaches"
          },
          {
            "id": "ds11",
            "type": "decision",
            "label": "Any anomalous transactions?",
            "detail": "Check if any transactions were flagged during categorization step"
          },
          {
            "id": "ds12",
            "type": "connector",
            "label": "Send Slack anomaly alert",
            "detail": "POST chat.postMessage with flagged transaction details, reason for flag, and recommended actions",
            "connector": "slack"
          },
          {
            "id": "ds13",
            "type": "action",
            "label": "Save updated sync state",
            "detail": "file_write updated cursor, merchant history, and monthly totals cache to local JSON files"
          },
          {
            "id": "ds14",
            "type": "end",
            "label": "Daily sync complete",
            "detail": "All transactions processed, budget checked, alerts sent, state persisted"
          },
          {
            "id": "ds15",
            "type": "error",
            "label": "Plaid sync failure",
            "error_message": "Plaid API returned an error (ITEM_LOGIN_REQUIRED, rate limit, or network failure). Transactions queued for retry."
          },
          {
            "id": "ds16",
            "type": "error",
            "label": "Sheets write failure",
            "error_message": "Google Sheets API returned 403/429/404. Transactions saved to local pending_transactions.json for retry on next cycle."
          }
        ],
        "edges": [
          {
            "id": "de1",
            "source": "ds1",
            "target": "ds2"
          },
          {
            "id": "de2",
            "source": "ds2",
            "target": "ds3"
          },
          {
            "id": "de3",
            "source": "ds3",
            "target": "ds4"
          },
          {
            "id": "de4",
            "source": "ds4",
            "target": "ds5",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "de5",
            "source": "ds4",
            "target": "ds13",
            "label": "No new transactions",
            "variant": "no"
          },
          {
            "id": "de6",
            "source": "ds5",
            "target": "ds6"
          },
          {
            "id": "de7",
            "source": "ds6",
            "target": "ds7"
          },
          {
            "id": "de8",
            "source": "ds7",
            "target": "ds8"
          },
          {
            "id": "de9",
            "source": "ds8",
            "target": "ds9",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "de10",
            "source": "ds8",
            "target": "ds11",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "de11",
            "source": "ds9",
            "target": "ds10"
          },
          {
            "id": "de12",
            "source": "ds10",
            "target": "ds11"
          },
          {
            "id": "de13",
            "source": "ds11",
            "target": "ds12",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "de14",
            "source": "ds11",
            "target": "ds13",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "de15",
            "source": "ds12",
            "target": "ds13"
          },
          {
            "id": "de16",
            "source": "ds13",
            "target": "ds14"
          },
          {
            "id": "de17",
            "source": "ds3",
            "target": "ds15",
            "variant": "error"
          },
          {
            "id": "de18",
            "source": "ds6",
            "target": "ds16",
            "variant": "error"
          },
          {
            "id": "de19",
            "source": "ds15",
            "target": "ds13"
          },
          {
            "id": "de20",
            "source": "ds16",
            "target": "ds13"
          }
        ]
      },
      {
        "id": "flow_weekly_report",
        "name": "Weekly Spending Summary Report",
        "description": "Every Monday, aggregates the past week's transactions from Google Sheets, computes category breakdowns and trends, and delivers a condensed Slack summary plus a detailed HTML Gmail report.",
        "nodes": [
          {
            "id": "wr1",
            "type": "start",
            "label": "Monday 8AM schedule trigger",
            "detail": "Cron trigger fires at 0 8 * * 1 to generate the weekly spending report"
          },
          {
            "id": "wr2",
            "type": "connector",
            "label": "Read week's transactions",
            "detail": "GET /spreadsheets/{id}/values/Transactions!A:H and filter rows where Date falls within the past 7 days",
            "connector": "google_workspace"
          },
          {
            "id": "wr3",
            "type": "decision",
            "label": "Transactions found for this week?",
            "detail": "Check if any transactions exist in the date range. If none, send a brief 'no activity' note instead."
          },
          {
            "id": "wr4",
            "type": "action",
            "label": "Compute spending analytics",
            "detail": "Calculate: total spent, per-category breakdown (amount + percentage), top 5 merchants, daily trend, week-over-week comparison using stored previous week data"
          },
          {
            "id": "wr5",
            "type": "connector",
            "label": "Read budget limits",
            "detail": "GET /spreadsheets/{id}/values/Budgets!A:C to calculate budget utilization percentages per category",
            "connector": "google_workspace"
          },
          {
            "id": "wr6",
            "type": "action",
            "label": "Format reports",
            "detail": "Generate a condensed Block Kit summary for Slack and a detailed HTML report with inline tables for Gmail"
          },
          {
            "id": "wr7",
            "type": "connector",
            "label": "Post Slack summary",
            "detail": "POST chat.postMessage with Block Kit sections: total spent, top categories bar, top merchants, budget status, week-over-week delta",
            "connector": "slack"
          },
          {
            "id": "wr8",
            "type": "event",
            "label": "Send Gmail detailed report",
            "detail": "gmail_send with HTML body containing full category table, merchant table, daily spending chart data, and 4-week trend comparison"
          },
          {
            "id": "wr9",
            "type": "action",
            "label": "Store weekly snapshot",
            "detail": "file_write this week's totals to local storage for use in next week's comparison calculations"
          },
          {
            "id": "wr10",
            "type": "end",
            "label": "Weekly report delivered",
            "detail": "Summary sent to Slack, detailed report sent to Gmail, snapshot stored for trends"
          },
          {
            "id": "wr11",
            "type": "error",
            "label": "Sheets read failure",
            "error_message": "Could not read transactions from Google Sheets. Report generation skipped. User notified via Slack."
          }
        ],
        "edges": [
          {
            "id": "we1",
            "source": "wr1",
            "target": "wr2"
          },
          {
            "id": "we2",
            "source": "wr2",
            "target": "wr3"
          },
          {
            "id": "we3",
            "source": "wr3",
            "target": "wr4",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "we4",
            "source": "wr3",
            "target": "wr7",
            "label": "No transactions",
            "variant": "no"
          },
          {
            "id": "we5",
            "source": "wr4",
            "target": "wr5"
          },
          {
            "id": "we6",
            "source": "wr5",
            "target": "wr6"
          },
          {
            "id": "we7",
            "source": "wr6",
            "target": "wr7"
          },
          {
            "id": "we8",
            "source": "wr7",
            "target": "wr8"
          },
          {
            "id": "we9",
            "source": "wr8",
            "target": "wr9"
          },
          {
            "id": "we10",
            "source": "wr9",
            "target": "wr10"
          },
          {
            "id": "we11",
            "source": "wr2",
            "target": "wr11",
            "variant": "error"
          },
          {
            "id": "we12",
            "source": "wr11",
            "target": "wr10"
          }
        ]
      },
      {
        "id": "flow_anomaly_escalation",
        "name": "High-Severity Anomaly Escalation",
        "description": "When a transaction is flagged as potentially fraudulent (>$1,000, foreign currency mismatch, or duplicate pattern), this flow escalates through multiple channels with detailed context and recommended actions.",
        "nodes": [
          {
            "id": "ae1",
            "type": "start",
            "label": "Anomalous transaction detected",
            "detail": "Triggered within the daily sync when a transaction matches high-severity fraud patterns"
          },
          {
            "id": "ae2",
            "type": "action",
            "label": "Assess severity level",
            "detail": "Score the transaction: >$1,000 amount (+3), unknown merchant (+2), foreign currency (+3), unusual hour (+1), duplicate pattern (+2). High severity = score >= 5."
          },
          {
            "id": "ae3",
            "type": "decision",
            "label": "High severity (score >= 5)?",
            "detail": "Determine if the anomaly score warrants multi-channel escalation or just a standard Slack alert"
          },
          {
            "id": "ae4",
            "type": "connector",
            "label": "Post urgent Slack alert",
            "detail": "POST chat.postMessage with red-flagged Block Kit alert including transaction details, anomaly reasons, severity score, and action buttons",
            "connector": "slack"
          },
          {
            "id": "ae5",
            "type": "event",
            "label": "Send Gmail fraud alert",
            "detail": "gmail_send with urgent subject line, full transaction context, merchant lookup results, historical comparison, and recommended actions (contact bank, freeze card)"
          },
          {
            "id": "ae6",
            "type": "action",
            "label": "Log to anomaly history",
            "detail": "file_write the flagged transaction with severity score and timestamp to anomaly_log.json for pattern tracking"
          },
          {
            "id": "ae7",
            "type": "connector",
            "label": "Post standard Slack alert",
            "detail": "POST chat.postMessage with yellow-flagged warning including transaction details and the specific anomaly reason",
            "connector": "slack"
          },
          {
            "id": "ae8",
            "type": "end",
            "label": "Escalation complete",
            "detail": "Appropriate channels notified based on severity. Transaction logged for future pattern analysis."
          }
        ],
        "edges": [
          {
            "id": "aee1",
            "source": "ae1",
            "target": "ae2"
          },
          {
            "id": "aee2",
            "source": "ae2",
            "target": "ae3"
          },
          {
            "id": "aee3",
            "source": "ae3",
            "target": "ae4",
            "label": "High severity",
            "variant": "yes"
          },
          {
            "id": "aee4",
            "source": "ae3",
            "target": "ae7",
            "label": "Standard",
            "variant": "no"
          },
          {
            "id": "aee5",
            "source": "ae4",
            "target": "ae5"
          },
          {
            "id": "aee6",
            "source": "ae5",
            "target": "ae6"
          },
          {
            "id": "aee7",
            "source": "ae7",
            "target": "ae6"
          },
          {
            "id": "aee8",
            "source": "ae6",
            "target": "ae8"
          }
        ]
      }
    ],
    "customSections": [
      {
        "key": "budget_categories",
        "label": "Budget Categories",
        "content": "The agent uses 13 standard budget categories for transaction classification:\n\n| Category | Description | Common Merchants |\n|----------|-------------|------------------|\n| Groceries | Supermarkets, food stores | Whole Foods, Trader Joe's, Costco |\n| Dining | Restaurants, cafes, delivery | Chipotle, Starbucks, DoorDash |\n| Transport | Gas, rideshare, transit, parking | Uber, Lyft, Shell, MTA |\n| Entertainment | Streaming, events, games | Netflix, Spotify, AMC |\n| Shopping | Retail, online shopping | Amazon, Target, Best Buy |\n| Bills & Utilities | Rent, electric, water, internet | ConEd, Comcast, Verizon |\n| Health | Pharmacy, doctor, gym | CVS, Equinox, Kaiser |\n| Education | Courses, books, tuition | Udemy, Amazon Books |\n| Travel | Hotels, flights, car rental | Airbnb, Delta, Hertz |\n| Subscriptions | Recurring SaaS and services | Adobe, iCloud, NYT |\n| Income | Payroll, refunds, deposits | Direct deposits, Venmo receives |\n| Transfers | Bank transfers, Venmo/Zelle sends | Internal transfers, P2P |\n| Other | Uncategorized | Anything not matching above |"
      },
      {
        "key": "anomaly_rules",
        "label": "Anomaly Detection Rules",
        "content": "The agent uses a multi-signal scoring system for transaction anomalies:\n\n**Flags (each adds to severity score):**\n- Amount > $500: +2 points\n- Amount > $1,000: +3 points (replaces the $500 flag)\n- Merchant never seen before in history: +2 points\n- Transaction between midnight and 5am local time: +1 point\n- Foreign currency on a domestic account: +3 points\n- Duplicate amount to same merchant within 24 hours: +2 points\n- Amount > 3x the average for that merchant: +2 points\n- Category mismatch (e.g., 'in-store' purchase for an online-only merchant): +2 points\n\n**Severity levels:**\n- Score 1â€“2: Log only, no alert\n- Score 3â€“4: Standard alert (Slack only)\n- Score 5+: High severity (Slack + Gmail with recommended actions)"
      }
    ]
  }
}
