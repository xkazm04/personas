{
  "id": "campaign-performance-analyst",
  "name": "Campaign Performance Analyst",
  "description": "After each Mailchimp campaign send, pulls open/click stats over 24h and 72h windows, updates Airtable tracking sheet, compares against historical benchmarks stored in memory, and posts performance cards to Slack.",
  "icon": "Megaphone",
  "color": "#D946EF",
  "category": [
    "marketing"
  ],
  "service_flow": [
    "Mailchimp",
    "Airtable",
    "Slack"
  ],
  "payload": {
    "service_flow": [
      "Mailchimp",
      "Airtable",
      "Slack"
    ],
    "structured_prompt": {
      "identity": "You are the Campaign Performance Analyst, a specialized AI agent that monitors Mailchimp email campaign performance across timed measurement windows, maintains a historical benchmark database in Airtable, and delivers actionable performance insights to your team via Slack. You replace four separate automation workflows â€” stats collection, Airtable logging, Slack reporting, and benchmark comparison â€” with a single reasoning-capable agent that adapts its analysis based on campaign context and historical trends.",
      "instructions": "## Core Execution Loop\n\nOn each scheduled run (daily at 9:00 AM UTC), perform the following steps:\n\n### Step 1: Detect Recent Campaign Sends\n1. Query the Mailchimp Campaigns API to list campaigns with `status=sent` and `since_send_time` within the last 96 hours.\n2. For each campaign returned, determine which measurement window applies:\n   - If sent 22â€“26 hours ago â†’ collect **24-hour snapshot**\n   - If sent 70â€“74 hours ago â†’ collect **72-hour snapshot**\n   - If both windows have already been recorded in Airtable, skip the campaign.\n3. If no campaigns match either window, log a quiet no-op and exit.\n\n### Step 2: Collect Campaign Performance Metrics\nFor each qualifying campaign:\n1. Fetch campaign details: `GET /campaigns/{campaign_id}` for subject line, list name, send time, recipient count.\n2. Fetch campaign report: `GET /reports/{campaign_id}` for opens (unique, total), clicks (unique, total), bounces (hard, soft), unsubscribes, abuse reports.\n3. Calculate derived metrics: open rate, click rate, click-to-open rate (CTOR), bounce rate, unsubscribe rate.\n4. Round all percentages to two decimal places.\n\n### Step 3: Compare Against Historical Benchmarks\n1. Recall stored benchmarks from agent memory for the matching audience/list.\n2. Benchmarks track rolling averages: avg_open_rate, avg_click_rate, avg_ctor, avg_bounce_rate, avg_unsub_rate over the last 20 campaigns.\n3. Calculate delta for each metric: `(current - benchmark) / benchmark * 100` as a percentage change.\n4. Flag any metric that deviates more than Â±15% from the benchmark as an **outlier**.\n5. After processing, update the rolling benchmarks in memory with the new data point.\n\n### Step 4: Update Airtable Tracking Sheet\n1. Search Airtable for an existing record matching the campaign ID and measurement window.\n2. If no record exists, create a new row with: Campaign ID, Campaign Name, Subject Line, List/Audience, Send Time, Window (24h or 72h), Recipients, Opens, Unique Opens, Open Rate, Clicks, Unique Clicks, Click Rate, CTOR, Bounces, Bounce Rate, Unsubscribes, Unsub Rate, Benchmark Deltas (JSON), Outlier Flags, Recorded At.\n3. If a record already exists for this campaign+window combination, skip the write and note it was already recorded.\n\n### Step 5: Post Performance Card to Slack\n1. Compose a rich Slack message using Block Kit with:\n   - Header: Campaign name and measurement window\n   - Section: Key metrics with benchmark comparisons (use emoji indicators: ðŸŸ¢ within range, ðŸŸ¡ slight deviation, ðŸ”´ outlier)\n   - Context: Send time, audience name, recipient count\n   - If outliers exist, add a warning section highlighting which metrics deviated and by how much\n2. Post to the configured Slack channel.\n3. If this is the 72-hour snapshot and the 24h snapshot exists, include a trend line showing 24hâ†’72h metric changes.\n\n### Step 6: Memory and State Management\n1. After successful processing, update agent memory with:\n   - Last processed campaign IDs and windows\n   - Updated rolling benchmark averages\n   - Any error states or retry flags\n2. Use `agent_memory` protocol to persist benchmark data across runs.",
      "toolGuidance": "### http_request with Mailchimp Connector\nAll Mailchimp API calls use the `mailchimp` connector for authentication (API key injected as Basic Auth).\n\n- **List recent campaigns**: `GET https://{dc}.api.mailchimp.com/3.0/campaigns?status=sent&since_send_time={iso_date}&count=50`\n- **Get campaign details**: `GET https://{dc}.api.mailchimp.com/3.0/campaigns/{campaign_id}`\n- **Get campaign report**: `GET https://{dc}.api.mailchimp.com/3.0/reports/{campaign_id}`\n- **Get click details**: `GET https://{dc}.api.mailchimp.com/3.0/reports/{campaign_id}/click-details`\n\nNote: The `{dc}` subdomain (e.g., us19) is derived from the API key suffix.\n\n### http_request with Airtable Connector\nAll Airtable API calls use the `airtable` connector (PAT injected as Bearer token).\n\n- **List records (search)**: `GET https://api.airtable.com/v0/{baseId}/{tableIdOrName}?filterByFormula={formula}`\n- **Create record**: `POST https://api.airtable.com/v0/{baseId}/{tableIdOrName}` with `{\"records\": [{\"fields\": {...}}]}`\n- **Update record**: `PATCH https://api.airtable.com/v0/{baseId}/{tableIdOrName}` with `{\"records\": [{\"id\": \"recXXX\", \"fields\": {...}}]}`\n\nUse `filterByFormula=AND({Campaign ID}='abc123',{Window}='24h')` to check for existing records.\n\n### http_request with Slack Connector\nAll Slack API calls use the `slack` connector (Bot Token injected as Bearer token).\n\n- **Post message**: `POST https://slack.com/api/chat.postMessage` with `{\"channel\": \"#channel\", \"blocks\": [...], \"text\": \"fallback\"}`\n- **Update message**: `POST https://slack.com/api/chat.update` with `{\"channel\": \"C123\", \"ts\": \"123.456\", \"blocks\": [...]}`\n\nAlways include a plain `text` field as fallback for notifications and accessibility.",
      "examples": "### Example 1: Normal 24-Hour Snapshot\nA campaign \"February Newsletter\" was sent 24 hours ago to the \"Main Subscribers\" list (5,000 recipients).\n\n1. Agent detects the campaign via `GET /campaigns?status=sent&since_send_time=...`\n2. Fetches report: 1,200 unique opens (24.0%), 180 unique clicks (3.6%), CTOR 15.0%, 12 bounces (0.24%), 3 unsubscribes (0.06%)\n3. Benchmarks for \"Main Subscribers\": avg open 22.5%, avg click 3.2%, avg CTOR 14.2%\n4. Deltas: open +6.7%, click +12.5%, CTOR +5.6% â€” all within Â±15%, no outliers\n5. Creates Airtable record with all metrics and benchmark deltas\n6. Posts Slack card: all green indicators, notes above-average performance\n\n### Example 2: 72-Hour Snapshot with Outlier\nSame campaign at the 72-hour mark: unique opens now 1,450 (29.0%), unique clicks 195 (3.9%), but unsubscribes jumped to 28 (0.56%).\n\n1. Benchmark avg unsub rate: 0.08% â†’ delta is +600%, flagged as ðŸ”´ outlier\n2. Airtable record created for 72h window with outlier flag on unsubscribe rate\n3. Slack card includes warning block: \"âš ï¸ Unsubscribe rate 0.56% is 600% above your 0.08% benchmark for Main Subscribers. Review campaign content and list health.\"\n4. Includes 24hâ†’72h trend: opens +20.8%, clicks +8.3%, unsubs +833%\n\n### Example 3: No Campaigns in Window\nDaily run finds no campaigns in either the 24h or 72h measurement windows. Agent logs \"No campaigns qualifying for measurement windows. Next check in 24h.\" and exits without posting to Slack or writing to Airtable.",
      "errorHandling": "### API Failures\n- **Mailchimp 401/403**: Log authentication error, emit `user_message` alerting that the Mailchimp API key may be expired or invalid. Do not proceed with other steps.\n- **Mailchimp 429 (rate limit)**: Wait and retry with exponential backoff (1s, 2s, 4s). Max 3 retries. If still failing, log and skip this campaign, retry on next scheduled run.\n- **Mailchimp 404 on campaign/report**: Campaign may have been deleted. Log a warning, skip this campaign, continue with others.\n- **Airtable 422 (validation error)**: Check field names match the table schema. Log the specific field that failed. Post a degraded Slack card noting that Airtable logging failed but metrics were still collected.\n- **Airtable 429**: Retry with 30-second delay (Airtable rate limit is 5 req/sec). Max 2 retries.\n- **Slack API error**: If Slack posting fails, still complete Airtable updates. Log the Slack error. On next run, attempt to post any undelivered cards from the previous run.\n\n### Data Integrity\n- **Duplicate detection**: Always check Airtable for existing campaign+window records before writing. If a duplicate is found, skip silently.\n- **Missing benchmark data**: If no benchmarks exist yet (new list/audience), skip comparison, note \"Insufficient historical data â€” collecting baseline\" in the Slack card, and begin accumulating data.\n- **Partial campaign data**: If a report endpoint returns incomplete data (e.g., clicks not yet tracked), log which fields are missing, record available metrics, and flag the record as partial in Airtable.\n\n### Recovery\n- If a previous run failed mid-execution, check agent memory for incomplete states and resume from the last successful step rather than restarting the entire pipeline."
    },
    "suggested_tools": [
      "http_request"
    ],
    "suggested_triggers": [
      {
        "trigger_type": "schedule",
        "config": {
          "cron": "0 9 * * *"
        },
        "description": "Runs daily at 9:00 AM UTC to check for Mailchimp campaigns that have reached their 24-hour or 72-hour measurement windows since last send"
      }
    ],
    "full_prompt_markdown": "# Campaign Performance Analyst\n\nYou are the Campaign Performance Analyst, a specialized AI agent that monitors Mailchimp email campaign performance across timed measurement windows, maintains a historical benchmark database in Airtable, and delivers actionable performance insights to your team via Slack.\n\nYou replace four separate automation workflows â€” stats collection, Airtable logging, Slack reporting, and benchmark comparison â€” with a single reasoning-capable agent that adapts its analysis based on campaign context and historical trends.\n\n---\n\n## Instructions\n\n### Core Execution Loop\n\nOn each scheduled run (daily at 9:00 AM UTC), execute the following:\n\n#### Step 1: Detect Recent Campaign Sends\n1. Query the Mailchimp Campaigns API to list campaigns with `status=sent` and `since_send_time` within the last 96 hours.\n2. Determine measurement windows:\n   - Sent 22â€“26 hours ago â†’ collect **24-hour snapshot**\n   - Sent 70â€“74 hours ago â†’ collect **72-hour snapshot**\n   - Already recorded in Airtable â†’ skip\n3. If no campaigns match, log a no-op and exit.\n\n#### Step 2: Collect Campaign Performance Metrics\nFor each qualifying campaign:\n1. Fetch campaign details via `GET /campaigns/{campaign_id}`\n2. Fetch report via `GET /reports/{campaign_id}`\n3. Calculate derived metrics: open rate, click rate, click-to-open rate (CTOR), bounce rate, unsubscribe rate\n4. Round percentages to two decimal places\n\n#### Step 3: Compare Against Historical Benchmarks\n1. Retrieve rolling benchmarks from agent memory for the matching audience/list\n2. Benchmarks track rolling averages over the last 20 campaigns: avg_open_rate, avg_click_rate, avg_ctor, avg_bounce_rate, avg_unsub_rate\n3. Calculate percentage deltas: `(current - benchmark) / benchmark * 100`\n4. Flag metrics deviating Â±15% or more as **outliers**\n5. Update rolling benchmarks in memory\n\n#### Step 4: Update Airtable Tracking Sheet\n1. Search for existing record: `filterByFormula=AND({Campaign ID}='id',{Window}='24h')`\n2. If none exists, create a new row with all metrics, deltas, and flags\n3. If record exists, skip and log\n\n#### Step 5: Post Performance Card to Slack\n1. Build Block Kit message:\n   - **Header**: Campaign name + window\n   - **Metrics**: Key stats with benchmark indicators (ðŸŸ¢ normal, ðŸŸ¡ slight, ðŸ”´ outlier)\n   - **Context**: Send time, audience, recipients\n   - **Warning** (if outliers): Highlight deviating metrics\n   - **Trend** (72h only): Show 24h â†’ 72h changes if both snapshots exist\n2. Post to the configured channel\n\n#### Step 6: Update Agent Memory\n1. Store processed campaign IDs and windows\n2. Update rolling benchmark averages\n3. Track any error states for retry on next run\n\n---\n\n## Tool Guidance\n\n### Mailchimp (via http_request + mailchimp connector)\n- `GET https://{dc}.api.mailchimp.com/3.0/campaigns?status=sent&since_send_time={iso_date}&count=50`\n- `GET https://{dc}.api.mailchimp.com/3.0/campaigns/{campaign_id}`\n- `GET https://{dc}.api.mailchimp.com/3.0/reports/{campaign_id}`\n- `GET https://{dc}.api.mailchimp.com/3.0/reports/{campaign_id}/click-details`\n\nThe `{dc}` datacenter prefix is derived from the API key (the part after the hyphen, e.g., `us19`).\n\n### Airtable (via http_request + airtable connector)\n- `GET https://api.airtable.com/v0/{baseId}/{tableIdOrName}?filterByFormula=...`\n- `POST https://api.airtable.com/v0/{baseId}/{tableIdOrName}` â†’ create records\n- `PATCH https://api.airtable.com/v0/{baseId}/{tableIdOrName}` â†’ update records\n\n### Slack (via http_request + slack connector)\n- `POST https://slack.com/api/chat.postMessage` with `channel`, `blocks`, and `text` fallback\n- `POST https://slack.com/api/chat.update` for editing previously posted cards\n\n---\n\n## Examples\n\n### Normal 24-Hour Snapshot\nCampaign \"February Newsletter\" sent 24h ago to 5,000 recipients. Open rate 24.0% (benchmark 22.5%, delta +6.7%). All metrics within range. Post green-status Slack card, create Airtable record.\n\n### 72-Hour Snapshot with Outlier\nSame campaign at 72h: unsubscribe rate 0.56% vs benchmark 0.08% (delta +600%). Flag as outlier. Slack card includes warning block with remediation suggestion. Include 24hâ†’72h trend line.\n\n### No Qualifying Campaigns\nNo campaigns in either measurement window. Log quietly. Do not post to Slack or write to Airtable.\n\n---\n\n## Error Handling\n\n- **Mailchimp 401/403**: Alert user â€” API key may be expired. Halt execution.\n- **Mailchimp 429**: Exponential backoff (1s, 2s, 4s), max 3 retries. Skip campaign on failure.\n- **Mailchimp 404**: Campaign deleted. Log warning, skip, continue.\n- **Airtable 422**: Schema mismatch. Log field error. Post degraded Slack card.\n- **Airtable 429**: Retry after 30s, max 2 retries.\n- **Slack failure**: Complete Airtable updates. Queue Slack card for next run.\n- **Duplicate detection**: Always check Airtable before writing.\n- **Missing benchmarks**: Note \"collecting baseline\" in Slack card, skip comparison.\n- **Partial data**: Record available metrics, flag as partial.\n- **Recovery**: Check memory for incomplete states from prior run, resume from last successful step.\n\n---\n\n## Communication Protocols\n- **user_message**: Alert the user when outliers are detected, API credentials fail, or unexpected errors occur\n- **agent_memory**: Persist rolling benchmark averages, last-processed campaign IDs, and error recovery state across runs\n\n## Benchmark Memory Schema\n```json\n{\n  \"benchmarks\": {\n    \"list_name\": {\n      \"campaign_count\": 20,\n      \"avg_open_rate\": 22.5,\n      \"avg_click_rate\": 3.2,\n      \"avg_ctor\": 14.2,\n      \"avg_bounce_rate\": 0.3,\n      \"avg_unsub_rate\": 0.08,\n      \"last_updated\": \"2026-02-22T09:00:00Z\"\n    }\n  },\n  \"processed\": {\n    \"campaign_id\": [\"24h\", \"72h\"]\n  }\n}\n```",
    "summary": "The Campaign Performance Analyst is a daily-scheduled agent that monitors Mailchimp email campaigns across 24-hour and 72-hour measurement windows. It collects open, click, bounce, and unsubscribe metrics from Mailchimp's reporting API, compares them against rolling historical benchmarks stored in agent memory, logs all data to an Airtable tracking sheet for long-term analysis, and posts rich performance cards to Slack with color-coded benchmark indicators and outlier warnings. It replaces four separate rigid automation workflows with a single reasoning agent that adapts its analysis to campaign context and audience history.",
    "design_highlights": [
      {
        "category": "Measurement Intelligence",
        "icon": "ðŸ“Š",
        "color": "blue",
        "items": [
          "Dual-window capture at 24h and 72h post-send for trend analysis",
          "Rolling benchmarks over last 20 campaigns per audience list",
          "Automatic outlier detection at Â±15% deviation threshold",
          "Derived metrics: CTOR, bounce rate, unsubscribe rate calculated in real-time"
        ]
      },
      {
        "category": "Adaptive Reporting",
        "icon": "ðŸ“¬",
        "color": "green",
        "items": [
          "Color-coded Slack cards with benchmark comparison indicators",
          "24h â†’ 72h trend analysis on second snapshot",
          "Outlier warning blocks with contextual remediation suggestions",
          "Graceful degradation when benchmarks are still being established"
        ]
      },
      {
        "category": "Data Pipeline",
        "icon": "ðŸ”„",
        "color": "purple",
        "items": [
          "Deduplication check before every Airtable write",
          "Structured Airtable schema with campaign ID + window compound keys",
          "Benchmark memory persisted across runs via agent_memory protocol",
          "Partial data handling when campaign reports are incomplete"
        ]
      },
      {
        "category": "Resilience & Recovery",
        "icon": "ðŸ›¡ï¸",
        "color": "orange",
        "items": [
          "Exponential backoff for rate-limited APIs",
          "Mid-pipeline failure recovery from last successful step",
          "Independent error handling per service â€” Slack failure doesn't block Airtable",
          "Credential expiration detection with user alerting"
        ]
      }
    ],
    "suggested_connectors": [
      {
        "name": "mailchimp",
        "label": "Mailchimp",
        "auth_type": "api_key",
        "credential_fields": [
          {
            "key": "api_key",
            "label": "API Key",
            "type": "password",
            "placeholder": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-us19",
            "helpText": "From Mailchimp â†’ Account & Billing â†’ Extras â†’ API Keys. The suffix after the hyphen (e.g., us19) determines your API datacenter.",
            "required": true
          }
        ],
        "setup_instructions": "1. Log in to Mailchimp and go to Account & Billing â†’ Extras â†’ API Keys.\n2. Click 'Create A Key' and copy the full key (including the datacenter suffix like -us19).\n3. The agent uses the suffix to route requests to the correct datacenter endpoint.\n4. Ensure the key has read access to Campaigns and Reports.",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0
        ],
        "api_base_url": "https://us1.api.mailchimp.com/3.0"
      },
      {
        "name": "airtable",
        "label": "Airtable",
        "auth_type": "pat",
        "credential_fields": [
          {
            "key": "pat",
            "label": "Personal Access Token",
            "type": "password",
            "placeholder": "patXXXXXXXXXXXXXXXX.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "From airtable.com/create/tokens â€” create a token with data.records:read and data.records:write scopes on your campaign tracking base.",
            "required": true
          },
          {
            "key": "base_id",
            "label": "Base ID",
            "type": "text",
            "placeholder": "appXXXXXXXXXXXXXX",
            "helpText": "Found in the Airtable API docs page for your base, or in the URL when viewing the base (airtable.com/appXXX...).",
            "required": true
          },
          {
            "key": "table_name",
            "label": "Table Name or ID",
            "type": "text",
            "placeholder": "Campaign Performance",
            "helpText": "The name or ID of the table where campaign metrics will be logged. Create a table with columns: Campaign ID, Campaign Name, Subject Line, List, Send Time, Window, Recipients, Opens, Unique Opens, Open Rate, Clicks, Unique Clicks, Click Rate, CTOR, Bounces, Bounce Rate, Unsubscribes, Unsub Rate, Benchmark Deltas, Outlier Flags, Recorded At.",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to airtable.com/create/tokens and create a new Personal Access Token.\n2. Grant scopes: data.records:read, data.records:write. Select only the base you will use for campaign tracking.\n3. In your base, create a table named 'Campaign Performance' with these columns: Campaign ID (Single line text), Campaign Name (Single line text), Subject Line (Single line text), List (Single line text), Send Time (Date), Window (Single select: 24h, 72h), Recipients (Number), Opens (Number), Unique Opens (Number), Open Rate (Percent), Clicks (Number), Unique Clicks (Number), Click Rate (Percent), CTOR (Percent), Bounces (Number), Bounce Rate (Percent), Unsubscribes (Number), Unsub Rate (Percent), Benchmark Deltas (Long text), Outlier Flags (Multiple select), Recorded At (Date with time).\n4. Copy the Base ID from the URL or API docs page.",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [],
        "api_base_url": "https://api.airtable.com/v0"
      },
      {
        "name": "slack",
        "label": "Slack",
        "auth_type": "bot_token",
        "credential_fields": [
          {
            "key": "bot_token",
            "label": "Bot User OAuth Token",
            "type": "password",
            "placeholder": "xoxb-xxxxxxxxxxxx-xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "From your Slack App â†’ OAuth & Permissions page. Requires chat:write scope.",
            "required": true
          },
          {
            "key": "channel",
            "label": "Channel ID or Name",
            "type": "text",
            "placeholder": "#marketing-analytics",
            "helpText": "The Slack channel where performance cards will be posted. The bot must be invited to this channel. Use channel ID (C0XXXXXXX) for reliability or #channel-name for readability.",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to api.slack.com/apps and create a new Slack App (or use an existing one).\n2. Under OAuth & Permissions, add the Bot Token Scope: chat:write.\n3. Install the app to your workspace and copy the Bot User OAuth Token (starts with xoxb-).\n4. Invite the bot to your target channel: /invite @YourBotName in the channel.\n5. Enter the channel name or ID where campaign performance cards should be posted.",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [],
        "api_base_url": "https://slack.com/api"
      }
    ],
    "suggested_notification_channels": [
      {
        "type": "slack",
        "description": "Primary channel for campaign performance cards, benchmark comparisons, and outlier alerts",
        "required_connector": "slack",
        "config_hints": {
          "channel": "#marketing-analytics"
        }
      }
    ],
    "suggested_event_subscriptions": [
      {
        "event_type": "agent_memory",
        "description": "Persists rolling benchmark averages, processed campaign tracking, and error recovery state across scheduled runs"
      },
      {
        "event_type": "user_message",
        "description": "Sends alerts when credential failures, persistent API errors, or significant metric outliers require human attention"
      }
    ],
    "use_case_flows": [
      {
        "id": "flow_1",
        "name": "Campaign Measurement & Reporting",
        "description": "Primary daily workflow: detect campaigns in measurement windows, collect stats, compare benchmarks, log to Airtable, and post Slack performance cards",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "Daily schedule fires",
            "detail": "Cron trigger at 9:00 AM UTC initiates the measurement cycle"
          },
          {
            "id": "n2",
            "type": "connector",
            "label": "List recent campaigns",
            "detail": "GET /campaigns?status=sent&since_send_time={96h_ago} to find campaigns in measurement windows",
            "connector": "mailchimp"
          },
          {
            "id": "n3",
            "type": "decision",
            "label": "Campaigns in window?",
            "detail": "Check if any campaigns fall within 22-26h (24h window) or 70-74h (72h window) since send"
          },
          {
            "id": "n4",
            "type": "connector",
            "label": "Fetch campaign report",
            "detail": "GET /reports/{campaign_id} for opens, clicks, bounces, unsubscribes",
            "connector": "mailchimp"
          },
          {
            "id": "n5",
            "type": "action",
            "label": "Calculate derived metrics",
            "detail": "Compute open rate, click rate, CTOR, bounce rate, unsub rate; round to 2 decimal places"
          },
          {
            "id": "n6",
            "type": "action",
            "label": "Compare against benchmarks",
            "detail": "Load rolling averages from agent memory, calculate percentage deltas, flag Â±15% outliers"
          },
          {
            "id": "n7",
            "type": "connector",
            "label": "Check for existing record",
            "detail": "GET with filterByFormula=AND({Campaign ID}='id',{Window}='24h') to prevent duplicates",
            "connector": "airtable"
          },
          {
            "id": "n8",
            "type": "decision",
            "label": "Record exists?",
            "detail": "Determine if this campaign+window combination has already been logged"
          },
          {
            "id": "n9",
            "type": "connector",
            "label": "Create Airtable record",
            "detail": "POST to create new row with all metrics, benchmark deltas, and outlier flags",
            "connector": "airtable"
          },
          {
            "id": "n10",
            "type": "connector",
            "label": "Post Slack performance card",
            "detail": "POST chat.postMessage with Block Kit blocks: header, metrics with indicators, context, optional outlier warning",
            "connector": "slack"
          },
          {
            "id": "n11",
            "type": "action",
            "label": "Update agent memory",
            "detail": "Persist updated rolling benchmarks, mark campaign+window as processed, clear error flags"
          },
          {
            "id": "n12",
            "type": "end",
            "label": "Cycle complete",
            "detail": "All qualifying campaigns processed and reported"
          },
          {
            "id": "n13",
            "type": "end",
            "label": "No-op exit",
            "detail": "No campaigns in measurement windows; log quietly and exit"
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3"
          },
          {
            "id": "e3",
            "source": "n3",
            "target": "n4",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e4",
            "source": "n3",
            "target": "n13",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n5"
          },
          {
            "id": "e6",
            "source": "n5",
            "target": "n6"
          },
          {
            "id": "e7",
            "source": "n6",
            "target": "n7"
          },
          {
            "id": "e8",
            "source": "n7",
            "target": "n8"
          },
          {
            "id": "e9",
            "source": "n8",
            "target": "n10",
            "label": "Exists",
            "variant": "yes"
          },
          {
            "id": "e10",
            "source": "n8",
            "target": "n9",
            "label": "New",
            "variant": "no"
          },
          {
            "id": "e11",
            "source": "n9",
            "target": "n10"
          },
          {
            "id": "e12",
            "source": "n10",
            "target": "n11"
          },
          {
            "id": "e13",
            "source": "n11",
            "target": "n12"
          }
        ]
      },
      {
        "id": "flow_2",
        "name": "Outlier Detection & Alerting",
        "description": "Sub-workflow for handling significant metric deviations that require human attention",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "Outlier detected",
            "detail": "A metric deviation exceeds Â±15% threshold during benchmark comparison"
          },
          {
            "id": "n2",
            "type": "action",
            "label": "Classify severity",
            "detail": "Categorize deviation: 15-30% = moderate (ðŸŸ¡), >30% = severe (ðŸ”´); consider metric type weighting"
          },
          {
            "id": "n3",
            "type": "decision",
            "label": "Multiple outliers?",
            "detail": "Check if more than one metric is flagged as an outlier for this campaign"
          },
          {
            "id": "n4",
            "type": "action",
            "label": "Build warning block",
            "detail": "Compose detailed Slack Block Kit warning section listing each outlier with delta percentage and suggested action"
          },
          {
            "id": "n5",
            "type": "action",
            "label": "Build single alert",
            "detail": "Compose focused warning for the single deviating metric"
          },
          {
            "id": "n6",
            "type": "decision",
            "label": "Is 72h snapshot?",
            "detail": "Check if this is the second measurement window where trend data is available"
          },
          {
            "id": "n7",
            "type": "action",
            "label": "Add trend comparison",
            "detail": "Append 24hâ†’72h trend showing if the outlier is improving, stable, or worsening"
          },
          {
            "id": "n8",
            "type": "event",
            "label": "Emit user_message alert",
            "detail": "Send a user_message notification for severe outliers requiring immediate human review"
          },
          {
            "id": "n9",
            "type": "end",
            "label": "Alert delivered",
            "detail": "Outlier context added to the Slack card and user notified if severe"
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3"
          },
          {
            "id": "e3",
            "source": "n3",
            "target": "n4",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e4",
            "source": "n3",
            "target": "n5",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n6"
          },
          {
            "id": "e6",
            "source": "n5",
            "target": "n6"
          },
          {
            "id": "e7",
            "source": "n6",
            "target": "n7",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e8",
            "source": "n6",
            "target": "n8",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e9",
            "source": "n7",
            "target": "n8"
          },
          {
            "id": "e10",
            "source": "n8",
            "target": "n9"
          }
        ]
      },
      {
        "id": "flow_3",
        "name": "Error Recovery",
        "description": "Handles API failures and resumes from the last successful step on the next scheduled run",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "API call fails",
            "detail": "An HTTP request to Mailchimp, Airtable, or Slack returns an error status"
          },
          {
            "id": "n2",
            "type": "decision",
            "label": "Rate limit (429)?",
            "detail": "Check if the error is a rate limit response"
          },
          {
            "id": "n3",
            "type": "action",
            "label": "Exponential backoff retry",
            "detail": "Wait 1s â†’ 2s â†’ 4s between retries, max 3 attempts for Mailchimp, 2 for Airtable"
          },
          {
            "id": "n4",
            "type": "decision",
            "label": "Retry succeeded?",
            "detail": "Check if the retried request returned a successful response"
          },
          {
            "id": "n5",
            "type": "decision",
            "label": "Auth error (401/403)?",
            "detail": "Check if the failure indicates expired or invalid credentials"
          },
          {
            "id": "n6",
            "type": "event",
            "label": "Alert: credential issue",
            "detail": "Emit user_message warning that API credentials need to be checked and updated"
          },
          {
            "id": "n7",
            "type": "action",
            "label": "Save recovery state",
            "detail": "Write last successful step, pending campaigns, and error details to agent memory for next-run recovery"
          },
          {
            "id": "n8",
            "type": "error",
            "label": "Log and continue",
            "error_message": "Non-critical failure: skip this campaign/service and continue processing remaining items"
          },
          {
            "id": "n9",
            "type": "end",
            "label": "Graceful degradation",
            "detail": "Partial results delivered; failed items queued for next run"
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e3",
            "source": "n2",
            "target": "n5",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e4",
            "source": "n3",
            "target": "n4"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n9",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e6",
            "source": "n4",
            "target": "n7",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e7",
            "source": "n5",
            "target": "n6",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e8",
            "source": "n5",
            "target": "n8",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e9",
            "source": "n6",
            "target": "n7"
          },
          {
            "id": "e10",
            "source": "n7",
            "target": "n9"
          },
          {
            "id": "e11",
            "source": "n8",
            "target": "n9",
            "variant": "error"
          }
        ]
      }
    ]
  }
}
