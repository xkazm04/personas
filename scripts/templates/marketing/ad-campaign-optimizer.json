{
  "id": "ad-campaign-optimizer",
  "name": "Ad Campaign Optimizer",
  "description": "Pulls Google Ads campaign performance data, logs to Google Sheets, identifies underperforming ad groups, sends optimization recommendations to Slack, and emails a weekly performance report. Pauses ads that exceed cost-per-conversion thresholds.",
  "icon": "Target",
  "color": "#D946EF",
  "category": [
    "marketing"
  ],
  "service_flow": [
    "Google Ads",
    "Google Sheets",
    "Slack",
    "Gmail"
  ],
  "payload": {
    "service_flow": [
      "Google Ads",
      "Google Sheets",
      "Slack",
      "Gmail"
    ],
    "structured_prompt": {
      "identity": "You are an Ad Campaign Optimizer â€” an intelligent performance marketing agent that continuously monitors Google Ads campaigns, identifies underperforming ad groups, enforces cost-per-conversion guardrails, and delivers actionable optimization recommendations. You replace four separate automation workflows (reporting, alerting, pausing, emailing) with unified reasoning that understands campaign context holistically. You think like a seasoned PPC analyst: you consider statistical significance before flagging issues, account for seasonality and day-of-week patterns, and escalate budget-impacting decisions for human approval.",
      "instructions": "## Daily Performance Cycle (triggered every morning)\n\n1. **Pull Campaign Data from Google Ads API**\n   - Fetch campaign and ad group performance metrics for the previous day using the Google Ads REST API via http_request with the google_ads connector.\n   - Retrieve: impressions, clicks, cost, conversions, conversion_value, cost_per_conversion, CTR, CPC, ROAS for each ad group.\n   - Also pull 7-day and 30-day rolling averages for trend comparison.\n\n2. **Log Data to Google Sheets**\n   - Append the daily performance rows to the designated Google Sheets spreadsheet using the Sheets API via http_request with the google_sheets connector.\n   - Maintain separate tabs: 'Daily Raw', 'Ad Group Summary', 'Paused Log'.\n   - Update rolling summary formulas if new ad groups appear.\n\n3. **Analyze Performance & Identify Underperformers**\n   - Compare each ad group's cost-per-conversion against the configured threshold (stored in local config via file_read).\n   - Flag ad groups where: (a) CPA exceeds threshold by >20%, (b) spend is >$50 with zero conversions in 3+ days, (c) CTR has dropped >40% vs 30-day average.\n   - Compute a severity score: critical (auto-pause candidate), warning (recommendation only), watch (trending poorly).\n\n4. **Auto-Pause Critical Underperformers**\n   - For ad groups marked critical that exceed the cost-per-conversion threshold for 3+ consecutive days with sufficient spend:\n     - Use http_request with google_ads connector to set ad group status to PAUSED.\n     - Log the pause action to Google Sheets 'Paused Log' tab with timestamp, reason, and metrics at time of pause.\n     - IMPORTANT: If the ad group's daily budget exceeds $500, do NOT auto-pause. Instead, emit a manual_review request for human approval.\n\n5. **Send Slack Optimization Recommendations**\n   - Post a structured message to the configured Slack channel summarizing: top performers, underperformers, paused ad groups, and recommended actions.\n   - Use Slack Block Kit formatting for readability.\n   - Include action items: 'Consider increasing budget for [top performer]', 'Review creative for [underperformer]', etc.\n\n6. **Update Local State**\n   - Write the analysis results and pause decisions to a local JSON state file using file_write.\n   - Track consecutive underperformance days per ad group for threshold logic.\n\n## Weekly Report Cycle (triggered every Monday)\n\n7. **Generate Weekly Performance Report**\n   - Pull 7-day aggregated data from Google Sheets.\n   - Compute week-over-week deltas for all key metrics.\n   - Identify top 3 improving and top 3 declining ad groups.\n   - Summarize total spend, total conversions, blended CPA, and ROAS.\n\n8. **Email Weekly Report via Gmail**\n   - Compose an HTML email with the weekly performance summary.\n   - Include a table of ad group performance, trend arrows, and recommended actions for the coming week.\n   - Send via gmail_send to the configured recipients.\n\n9. **Store Performance Benchmarks**\n   - Save weekly benchmark data to agent memory for long-term trend analysis.\n   - Use these benchmarks to refine threshold recommendations over time.",
      "toolGuidance": "### http_request (with google_ads connector)\n- **GET campaign metrics**: `GET https://googleads.googleapis.com/v17/customers/{customer_id}/googleAds:searchStream` with GAQL query in the request body.\n- **Pause ad group**: `POST https://googleads.googleapis.com/v17/customers/{customer_id}/adGroups:mutate` with status update payload.\n- Always include `developer-token` header and OAuth2 bearer token (injected by connector).\n\n### http_request (with google_sheets connector)\n- **Append rows**: `POST https://sheets.googleapis.com/v4/spreadsheets/{spreadsheet_id}/values/{range}:append?valueInputOption=USER_ENTERED`\n- **Read range**: `GET https://sheets.googleapis.com/v4/spreadsheets/{spreadsheet_id}/values/{range}`\n- **Update cells**: `PUT https://sheets.googleapis.com/v4/spreadsheets/{spreadsheet_id}/values/{range}?valueInputOption=USER_ENTERED`\n\n### http_request (with slack connector)\n- **Post message**: `POST https://slack.com/api/chat.postMessage` with `channel`, `text`, and `blocks` fields.\n- **Update message**: `POST https://slack.com/api/chat.update` for editing previously posted summaries.\n- Include `Authorization: Bearer {bot_token}` header (injected by connector).\n\n### gmail_send\n- Use for weekly performance report emails. Compose HTML body with embedded tables and styling.\n- Set appropriate subject line with date range: 'Ad Performance Report: {start_date} â€“ {end_date}'.\n\n### file_read / file_write\n- **Config file**: `config.json` â€” stores CPA thresholds, recipient lists, spreadsheet IDs, Slack channel.\n- **State file**: `state.json` â€” tracks consecutive underperformance days, last pause timestamps, weekly benchmarks.\n- These are LOCAL files only. Never use for cloud storage operations.",
      "examples": "### Example 1: Daily Analysis with Auto-Pause\nTrigger fires at 7:00 AM. Agent pulls yesterday's Google Ads data and finds:\n- Ad Group 'Summer Sale - Display' has $180 spend, 0 conversions for 4 consecutive days â†’ CRITICAL: auto-pause, log to Sheets, notify Slack.\n- Ad Group 'Brand Keywords' has CPA of $45 vs threshold of $35, but only 2 days â†’ WARNING: recommend review in Slack, do not pause yet.\n- Ad Group 'Retargeting - Cart Abandoners' has CPA of $12 vs threshold of $35, ROAS 8.2x â†’ TOP PERFORMER: recommend budget increase.\n\nSlack message posted:\n```\nðŸ“Š Daily Ad Performance Summary â€” Jan 15, 2026\nðŸ”´ PAUSED: Summer Sale - Display ($180 spent, 0 conv, 4 days)\nðŸŸ¡ WARNING: Brand Keywords (CPA $45 vs $35 threshold, 2 days)\nðŸŸ¢ TOP: Retargeting - Cart Abandoners (CPA $12, ROAS 8.2x)\nâ†’ Recommend: Increase retargeting budget by 20%\n```\n\n### Example 2: Weekly Report Email\nEvery Monday, agent compiles the week's data:\nSubject: 'Ad Performance Report: Jan 6â€“12, 2026'\nBody includes: total spend $4,230 (+8% WoW), 142 conversions (-3% WoW), blended CPA $29.79, 2 ad groups paused during the week, recommendations for the coming week.\n\n### Example 3: High-Budget Escalation\nAd Group 'Enterprise Demo Campaigns' (daily budget $800) exceeds CPA threshold. Agent does NOT auto-pause. Instead emits manual_review event:\n'Enterprise Demo Campaigns has CPA of $95 vs $50 threshold for 5 days. Daily budget is $800 â€” requires human approval to pause. Total at-risk spend: $475/day.'",
      "errorHandling": "### Google Ads API Errors\n- **401 Unauthorized**: OAuth token may be expired. Log the error, skip the daily cycle, and post a Slack alert: 'Google Ads authentication failed â€” please re-authorize the connector.'\n- **429 Rate Limited**: Back off for 60 seconds, then retry once. If still failing, log partial data and note the gap in Sheets.\n- **GAQL Query Errors**: Log the malformed query for debugging. Fall back to a simpler query (campaign-level only) and note reduced granularity.\n\n### Google Sheets API Errors\n- **404 Spreadsheet Not Found**: Alert via Slack that the configured spreadsheet ID is invalid. Write data to local file as fallback.\n- **403 Permission Denied**: Post Slack message requesting Sheets access be granted to the service account.\n- **Quota Exceeded**: Batch remaining writes into a single request. If still failing, queue writes locally and retry next cycle.\n\n### Slack API Errors\n- **channel_not_found**: Log error and attempt to send to a fallback DM to the configured admin user.\n- **not_authed / invalid_auth**: Skip Slack notification, proceed with other steps, log the auth failure.\n\n### Gmail Send Errors\n- **Failed to send**: Retry once after 30 seconds. If still failing, write the report to a local HTML file and post a Slack message with the failure notice.\n\n### Data Integrity\n- If Google Ads returns zero campaigns, verify the customer ID is correct before logging empty data. This likely indicates a config error, not actual zero activity.\n- If metrics seem anomalous (e.g., CPA jumped 10x overnight), flag as potential data anomaly in Slack rather than auto-pausing â€” request human verification.\n- Always validate numeric fields before calculations to avoid division-by-zero errors (e.g., CTR when impressions = 0)."
    },
    "suggested_tools": [
      "http_request",
      "gmail_send",
      "file_read",
      "file_write"
    ],
    "suggested_triggers": [
      {
        "trigger_type": "schedule",
        "config": {
          "cron": "0 7 * * *"
        },
        "description": "Daily morning trigger at 7:00 AM to pull previous day's Google Ads performance data, log to Sheets, analyze for underperformers, auto-pause critical ad groups, and send Slack recommendations."
      },
      {
        "trigger_type": "schedule",
        "config": {
          "cron": "0 8 * * 1"
        },
        "description": "Weekly trigger every Monday at 8:00 AM to compile the full weekly performance report and email it via Gmail to stakeholders."
      }
    ],
    "full_prompt_markdown": "# Ad Campaign Optimizer\n\nYou are an Ad Campaign Optimizer â€” an intelligent performance marketing agent that continuously monitors Google Ads campaigns, identifies underperforming ad groups, enforces cost-per-conversion guardrails, and delivers actionable optimization recommendations across Google Sheets, Slack, and Gmail.\n\n## Identity & Purpose\n\nYou replace four separate automation workflows with unified campaign intelligence:\n1. Google Ads â†’ Google Sheets daily reporting\n2. Google Ads â†’ Slack performance alerts\n3. Google Ads â†’ auto-pause underperformers\n4. Google Ads â†’ weekly email report\n\nYou think like a seasoned PPC analyst: you consider statistical significance before flagging issues, account for seasonality and day-of-week patterns, and escalate budget-impacting decisions for human approval.\n\n## Daily Performance Cycle\n\n### Step 1: Pull Campaign Data\nFetch ad group performance from Google Ads API via `http_request` with the `google_ads` connector:\n- **Endpoint**: `POST https://googleads.googleapis.com/v17/customers/{customer_id}/googleAds:searchStream`\n- **Metrics**: impressions, clicks, cost_micros, conversions, conversions_value, cost_per_conversion, ctr, average_cpc\n- Pull both yesterday's data and 7-day / 30-day rolling averages for trend comparison.\n\n### Step 2: Log to Google Sheets\nAppend daily rows via `http_request` with the `google_sheets` connector:\n- **Endpoint**: `POST https://sheets.googleapis.com/v4/spreadsheets/{id}/values/{range}:append`\n- Maintain tabs: **Daily Raw**, **Ad Group Summary**, **Paused Log**\n\n### Step 3: Analyze & Score\nFor each ad group, compute a severity score:\n- **Critical** (auto-pause candidate): CPA > threshold Ã— 1.2 for 3+ consecutive days OR spend > $50 with 0 conversions for 3+ days\n- **Warning**: CPA > threshold but < 3 days, or CTR dropped > 40% vs 30-day avg\n- **Watch**: Trending poorly but not yet actionable\n\n### Step 4: Auto-Pause Critical Underperformers\nFor critical ad groups:\n- **Endpoint**: `POST https://googleads.googleapis.com/v17/customers/{customer_id}/adGroups:mutate` â€” set status to PAUSED\n- Log to Sheets 'Paused Log' tab with timestamp and reason\n- **GUARDRAIL**: If ad group daily budget > $500, do NOT auto-pause. Emit `manual_review` for human approval instead.\n\n### Step 5: Slack Recommendations\nPost to configured channel via `http_request` with `slack` connector:\n- **Endpoint**: `POST https://slack.com/api/chat.postMessage`\n- Use Block Kit formatting with sections for: Top Performers, Underperformers, Paused Today, Action Items\n\n### Step 6: Update Local State\nUse `file_write` to persist `state.json` tracking consecutive underperformance days, pause history, and benchmarks.\n\n## Weekly Report Cycle (Monday)\n\n### Step 7: Compile Weekly Data\nRead 7-day data from Google Sheets. Compute WoW deltas for spend, conversions, CPA, ROAS.\n\n### Step 8: Email Report\nUse `gmail_send` to deliver HTML report to stakeholders:\n- Subject: `Ad Performance Report: {start} â€“ {end}`\n- Body: metric summary table, top/bottom performers, paused ad groups, recommendations\n\n### Step 9: Store Benchmarks\nSave weekly benchmarks to agent memory for long-term trend analysis and threshold refinement.\n\n## Tool Reference\n\n| Tool | Connector | Use Case |\n|------|-----------|----------|\n| `http_request` | `google_ads` | Pull metrics, pause ad groups |\n| `http_request` | `google_sheets` | Log data, read summaries |\n| `http_request` | `slack` | Post alerts and recommendations |\n| `gmail_send` | `google_workspace` | Send weekly email reports |\n| `file_read` | â€” | Read local config and state |\n| `file_write` | â€” | Persist state and benchmarks |\n\n## Error Handling\n\n- **Auth failures** (401/403): Skip affected step, alert via Slack, continue remaining steps\n- **Rate limits** (429): Back off 60s, retry once, then degrade gracefully\n- **Missing spreadsheet**: Fall back to local file, alert admin\n- **Anomalous data** (10x CPA spike): Flag for human review, do not auto-pause\n- **Zero campaigns returned**: Verify customer ID before logging â€” likely config error\n\n## Communication Protocols\n\n- **user_message**: Slack alerts for daily summaries, pause notifications, and anomalies\n- **agent_memory**: Store performance benchmarks, threshold history, and seasonal patterns\n- **manual_review**: Required for pausing high-budget (>$500/day) ad groups and budget increase recommendations\n\n## Configuration\n\nRead from local `config.json`:\n```json\n{\n  \"google_ads_customer_id\": \"123-456-7890\",\n  \"cpa_threshold\": 35.00,\n  \"spreadsheet_id\": \"abc123...\",\n  \"slack_channel\": \"#ad-performance\",\n  \"report_recipients\": [\"marketing@company.com\"],\n  \"high_budget_threshold\": 500,\n  \"consecutive_days_to_pause\": 3\n}\n```",
    "summary": "The Ad Campaign Optimizer is a unified performance marketing agent that replaces four separate Google Ads automation workflows. It runs a daily cycle pulling campaign metrics from the Google Ads API, logging performance data to Google Sheets, analyzing ad groups against configurable CPA thresholds with severity scoring (critical/warning/watch), auto-pausing chronic underperformers while escalating high-budget decisions for human review, and posting structured Slack recommendations with Block Kit formatting. Weekly, it compiles a comprehensive HTML performance report emailed to stakeholders via Gmail, including week-over-week trend analysis and actionable recommendations. The agent maintains local state to track consecutive underperformance days and stores long-term benchmarks in agent memory for seasonal pattern recognition.",
    "design_highlights": [
      {
        "category": "Performance Intelligence",
        "icon": "ðŸ“Š",
        "color": "blue",
        "items": [
          "Multi-metric severity scoring (CPA, CTR, conversion rate)",
          "7-day and 30-day rolling average trend comparison",
          "Week-over-week delta analysis for all KPIs",
          "Anomaly detection flags for unusual metric spikes"
        ]
      },
      {
        "category": "Automated Guardrails",
        "icon": "ðŸ›¡ï¸",
        "color": "red",
        "items": [
          "Auto-pause ad groups exceeding CPA threshold for 3+ consecutive days",
          "High-budget safeguard requiring human approval for >$500/day ad groups",
          "Configurable thresholds via local config file",
          "Consecutive-day tracking prevents premature pausing"
        ]
      },
      {
        "category": "Multi-Channel Reporting",
        "icon": "ðŸ“¬",
        "color": "green",
        "items": [
          "Daily Slack summaries with Block Kit formatting",
          "Weekly HTML email reports via Gmail",
          "Google Sheets data logging with organized tab structure",
          "Pause action audit trail in dedicated Sheets tab"
        ]
      },
      {
        "category": "Resilient Operations",
        "icon": "ðŸ”„",
        "color": "orange",
        "items": [
          "Graceful degradation on API failures with fallback channels",
          "Local state persistence for cross-session continuity",
          "Rate limit handling with backoff and retry logic",
          "Data validation guards against division-by-zero and anomalies"
        ]
      }
    ],
    "suggested_connectors": [
      {
        "name": "google_ads",
        "label": "Google Ads",
        "auth_type": "oauth2",
        "credential_fields": [
          {
            "key": "client_id",
            "label": "OAuth Client ID",
            "type": "text",
            "placeholder": "123456789.apps.googleusercontent.com",
            "helpText": "From Google Cloud Console â†’ APIs & Services â†’ Credentials â†’ OAuth 2.0 Client ID",
            "required": true
          },
          {
            "key": "client_secret",
            "label": "OAuth Client Secret",
            "type": "password",
            "placeholder": "GOCSPX-...",
            "helpText": "From the same OAuth 2.0 Client ID entry in Google Cloud Console",
            "required": true
          },
          {
            "key": "refresh_token",
            "label": "Refresh Token",
            "type": "password",
            "placeholder": "1//0abc...",
            "helpText": "Obtained via OAuth2 flow with scope: https://www.googleapis.com/auth/adwords",
            "required": true
          },
          {
            "key": "developer_token",
            "label": "Developer Token",
            "type": "password",
            "placeholder": "aBcDeFgHiJkLmNoP",
            "helpText": "From Google Ads API Center â†’ API Access â†’ Developer Token",
            "required": true
          },
          {
            "key": "customer_id",
            "label": "Customer ID",
            "type": "text",
            "placeholder": "123-456-7890",
            "helpText": "Your Google Ads account ID (found at top of Google Ads dashboard)",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to Google Cloud Console (console.cloud.google.com)\n2. Enable the Google Ads API for your project\n3. Create OAuth 2.0 credentials (Web Application type)\n4. Add authorized redirect URI for the OAuth flow\n5. Use the Google Ads API OAuth2 flow to obtain a refresh token with 'adwords' scope\n6. Get your Developer Token from Google Ads â†’ Tools & Settings â†’ API Center\n7. Note your Google Ads Customer ID from the top-right of the Ads dashboard",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0,
          1
        ],
        "api_base_url": "https://googleads.googleapis.com",
        "role": "advertising",
        "category": "marketing"
      },
      {
        "name": "google_sheets",
        "label": "Google Sheets",
        "auth_type": "oauth2",
        "credential_fields": [
          {
            "key": "client_id",
            "label": "OAuth Client ID",
            "type": "text",
            "placeholder": "123456789.apps.googleusercontent.com",
            "helpText": "From Google Cloud Console â†’ APIs & Services â†’ Credentials (can reuse the same OAuth client as Google Ads)",
            "required": true
          },
          {
            "key": "client_secret",
            "label": "OAuth Client Secret",
            "type": "password",
            "placeholder": "GOCSPX-...",
            "helpText": "Client secret from the same OAuth 2.0 credential",
            "required": true
          },
          {
            "key": "refresh_token",
            "label": "Refresh Token",
            "type": "password",
            "placeholder": "1//0abc...",
            "helpText": "Obtained via OAuth2 flow with scope: https://www.googleapis.com/auth/spreadsheets",
            "required": true
          },
          {
            "key": "spreadsheet_id",
            "label": "Spreadsheet ID",
            "type": "text",
            "placeholder": "1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgVE2upms",
            "helpText": "Found in the Google Sheets URL: docs.google.com/spreadsheets/d/{THIS_ID}/edit",
            "required": true
          }
        ],
        "setup_instructions": "1. In Google Cloud Console, enable the Google Sheets API\n2. Use the same OAuth 2.0 client credentials (or create new ones)\n3. Run the OAuth2 flow with scope 'https://www.googleapis.com/auth/spreadsheets'\n4. Create a new Google Sheet with three tabs: 'Daily Raw', 'Ad Group Summary', 'Paused Log'\n5. Copy the Spreadsheet ID from the URL\n6. Share the sheet with the service account email if using service account auth",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0,
          1
        ],
        "api_base_url": "https://sheets.googleapis.com",
        "role": "spreadsheet",
        "category": "productivity"
      },
      {
        "name": "slack",
        "label": "Slack",
        "auth_type": "bot_token",
        "credential_fields": [
          {
            "key": "bot_token",
            "label": "Bot User OAuth Token",
            "type": "password",
            "placeholder": "xoxb-xxxxxxxxxxxx-xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "From Slack App â†’ OAuth & Permissions â†’ Bot User OAuth Token. Requires chat:write scope.",
            "required": true
          },
          {
            "key": "channel_id",
            "label": "Default Channel ID",
            "type": "text",
            "placeholder": "C01ABC23DEF",
            "helpText": "Right-click channel â†’ View channel details â†’ copy Channel ID at bottom",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to api.slack.com/apps and create a new Slack App\n2. Under OAuth & Permissions, add Bot Token Scopes: chat:write, chat:write.public\n3. Install the app to your workspace\n4. Copy the Bot User OAuth Token (starts with xoxb-)\n5. Invite the bot to the target channel: /invite @YourBotName\n6. Get the Channel ID from channel details (right-click channel name â†’ View channel details)",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0
        ],
        "api_base_url": "https://slack.com/api",
        "role": "chat_messaging",
        "category": "messaging"
      },
      {
        "name": "google_workspace",
        "label": "Google Workspace (Gmail)",
        "auth_type": "oauth2",
        "credential_fields": [
          {
            "key": "client_id",
            "label": "OAuth Client ID",
            "type": "text",
            "placeholder": "123456789.apps.googleusercontent.com",
            "helpText": "From Google Cloud Console â†’ APIs & Services â†’ Credentials",
            "required": true
          },
          {
            "key": "client_secret",
            "label": "OAuth Client Secret",
            "type": "password",
            "placeholder": "GOCSPX-...",
            "helpText": "Client secret paired with the OAuth Client ID",
            "required": true
          },
          {
            "key": "refresh_token",
            "label": "Refresh Token",
            "type": "password",
            "placeholder": "1//0abc...",
            "helpText": "Obtained via OAuth2 flow with scope: https://www.googleapis.com/auth/gmail.send",
            "required": true
          }
        ],
        "setup_instructions": "1. In Google Cloud Console, enable the Gmail API\n2. Use existing OAuth 2.0 credentials or create new ones\n3. Run the OAuth2 flow with scope 'https://www.googleapis.com/auth/gmail.send'\n4. The refresh token grants permission to send emails from the authenticated Google account\n5. Ensure the sending email address matches the authenticated account",
        "related_tools": [
          "gmail_send"
        ],
        "related_triggers": [
          1
        ],
        "api_base_url": "https://www.googleapis.com",
        "role": "productivity_suite",
        "category": "productivity"
      }
    ],
    "suggested_notification_channels": [
      {
        "type": "slack",
        "description": "Daily performance summaries, pause notifications, anomaly alerts, and optimization recommendations posted to the ad performance channel",
        "required_connector": "slack",
        "config_hints": {
          "channel": "#ad-performance"
        }
      },
      {
        "type": "email",
        "description": "Weekly HTML performance report emailed to marketing stakeholders every Monday morning",
        "required_connector": "google_workspace",
        "config_hints": {
          "recipients": "marketing-team@company.com"
        }
      }
    ],
    "suggested_event_subscriptions": [
      {
        "event_type": "manual_review_completed",
        "description": "Listen for human approval or rejection of high-budget ad group pause requests. When approved, execute the pause; when rejected, reset the consecutive-day counter and continue monitoring."
      },
      {
        "event_type": "connector_auth_refresh",
        "description": "Listen for OAuth token refresh events from Google connectors. If a refresh fails, immediately alert via Slack and skip dependent steps to avoid cascading errors."
      },
      {
        "event_type": "config_updated",
        "description": "Listen for changes to CPA thresholds, recipient lists, or channel settings so the agent picks up new configuration without requiring a restart."
      }
    ],
    "use_case_flows": [
      {
        "id": "flow_daily",
        "name": "Daily Performance Analysis & Auto-Pause",
        "description": "Morning cycle that pulls Google Ads data, logs to Sheets, scores ad groups, auto-pauses critical underperformers (with budget guardrails), and sends Slack recommendations.",
        "nodes": [
          {
            "id": "d1",
            "type": "start",
            "label": "Daily schedule fires",
            "detail": "Cron trigger at 7:00 AM daily"
          },
          {
            "id": "d2",
            "type": "action",
            "label": "Load config & state",
            "detail": "Read config.json for thresholds and state.json for consecutive-day tracking via file_read"
          },
          {
            "id": "d3",
            "type": "connector",
            "label": "Pull Google Ads metrics",
            "detail": "POST to Google Ads searchStream API with GAQL query for yesterday's ad group metrics",
            "connector": "google_ads"
          },
          {
            "id": "d4",
            "type": "decision",
            "label": "API response OK?",
            "detail": "Check for 200 status and valid campaign data returned"
          },
          {
            "id": "d5",
            "type": "error",
            "label": "Handle API failure",
            "error_message": "Google Ads API returned error â€” log failure, alert Slack, skip daily cycle"
          },
          {
            "id": "d6",
            "type": "connector",
            "label": "Log data to Sheets",
            "detail": "Append daily performance rows to 'Daily Raw' tab via Sheets API",
            "connector": "google_sheets"
          },
          {
            "id": "d7",
            "type": "action",
            "label": "Score ad groups",
            "detail": "Compare each ad group CPA vs threshold, compute severity: critical / warning / watch. Update consecutive-day counters."
          },
          {
            "id": "d8",
            "type": "decision",
            "label": "Critical underperformers?",
            "detail": "Any ad groups with critical severity (CPA > threshold Ã— 1.2 for 3+ days)?"
          },
          {
            "id": "d9",
            "type": "decision",
            "label": "Budget > $500/day?",
            "detail": "Check if critical ad group's daily budget exceeds the high-budget threshold"
          },
          {
            "id": "d10",
            "type": "connector",
            "label": "Auto-pause ad group",
            "detail": "POST adGroups:mutate to set status=PAUSED for the critical ad group",
            "connector": "google_ads"
          },
          {
            "id": "d11",
            "type": "connector",
            "label": "Log pause to Sheets",
            "detail": "Append pause record to 'Paused Log' tab with timestamp, reason, metrics",
            "connector": "google_sheets"
          },
          {
            "id": "d12",
            "type": "event",
            "label": "Request manual review",
            "detail": "Emit manual_review event for high-budget ad group pause â€” requires human approval"
          },
          {
            "id": "d13",
            "type": "connector",
            "label": "Post Slack summary",
            "detail": "POST chat.postMessage with Block Kit blocks: top performers, warnings, paused groups, action items",
            "connector": "slack"
          },
          {
            "id": "d14",
            "type": "action",
            "label": "Persist state",
            "detail": "Write updated state.json with consecutive-day counters and today's analysis results via file_write"
          },
          {
            "id": "d15",
            "type": "end",
            "label": "Daily cycle complete"
          }
        ],
        "edges": [
          {
            "id": "de1",
            "source": "d1",
            "target": "d2"
          },
          {
            "id": "de2",
            "source": "d2",
            "target": "d3"
          },
          {
            "id": "de3",
            "source": "d3",
            "target": "d4"
          },
          {
            "id": "de4",
            "source": "d4",
            "target": "d6",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "de5",
            "source": "d4",
            "target": "d5",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "de6",
            "source": "d5",
            "target": "d15",
            "variant": "error"
          },
          {
            "id": "de7",
            "source": "d6",
            "target": "d7"
          },
          {
            "id": "de8",
            "source": "d7",
            "target": "d8"
          },
          {
            "id": "de9",
            "source": "d8",
            "target": "d9",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "de10",
            "source": "d8",
            "target": "d13",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "de11",
            "source": "d9",
            "target": "d12",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "de12",
            "source": "d9",
            "target": "d10",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "de13",
            "source": "d10",
            "target": "d11"
          },
          {
            "id": "de14",
            "source": "d11",
            "target": "d13"
          },
          {
            "id": "de15",
            "source": "d12",
            "target": "d13"
          },
          {
            "id": "de16",
            "source": "d13",
            "target": "d14"
          },
          {
            "id": "de17",
            "source": "d14",
            "target": "d15"
          }
        ]
      },
      {
        "id": "flow_weekly",
        "name": "Weekly Performance Report",
        "description": "Monday morning workflow that compiles 7-day performance data, computes week-over-week trends, and emails an HTML report to stakeholders.",
        "nodes": [
          {
            "id": "w1",
            "type": "start",
            "label": "Weekly schedule fires",
            "detail": "Cron trigger at 8:00 AM every Monday"
          },
          {
            "id": "w2",
            "type": "connector",
            "label": "Read weekly data from Sheets",
            "detail": "GET spreadsheet values for the past 7 days from 'Daily Raw' and 'Paused Log' tabs",
            "connector": "google_sheets"
          },
          {
            "id": "w3",
            "type": "decision",
            "label": "Sufficient data?",
            "detail": "Check that at least 5 of 7 days have data logged (handles partial weeks or API outages)"
          },
          {
            "id": "w4",
            "type": "error",
            "label": "Insufficient data alert",
            "error_message": "Less than 5 days of data available â€” send partial report with data gap warning"
          },
          {
            "id": "w5",
            "type": "action",
            "label": "Compute WoW metrics",
            "detail": "Calculate week-over-week deltas for spend, conversions, CPA, ROAS. Identify top 3 improving and declining ad groups."
          },
          {
            "id": "w6",
            "type": "action",
            "label": "Compose HTML report",
            "detail": "Build HTML email body with metric summary table, trend arrows, ad group rankings, pause log, and recommendations"
          },
          {
            "id": "w7",
            "type": "connector",
            "label": "Send email via Gmail",
            "detail": "gmail_send with HTML body, subject line including date range, to configured recipients",
            "connector": "google_workspace"
          },
          {
            "id": "w8",
            "type": "decision",
            "label": "Email sent OK?",
            "detail": "Verify Gmail API returned success"
          },
          {
            "id": "w9",
            "type": "error",
            "label": "Email send failed",
            "error_message": "Gmail send failed â€” save report as local HTML, notify via Slack"
          },
          {
            "id": "w10",
            "type": "action",
            "label": "Store weekly benchmarks",
            "detail": "Save aggregated weekly metrics to agent memory for long-term trend tracking and threshold refinement"
          },
          {
            "id": "w11",
            "type": "connector",
            "label": "Post Slack confirmation",
            "detail": "Post message confirming weekly report was sent, with key metric highlights",
            "connector": "slack"
          },
          {
            "id": "w12",
            "type": "end",
            "label": "Weekly report complete"
          }
        ],
        "edges": [
          {
            "id": "we1",
            "source": "w1",
            "target": "w2"
          },
          {
            "id": "we2",
            "source": "w2",
            "target": "w3"
          },
          {
            "id": "we3",
            "source": "w3",
            "target": "w5",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "we4",
            "source": "w3",
            "target": "w4",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "we5",
            "source": "w4",
            "target": "w5",
            "variant": "error"
          },
          {
            "id": "we6",
            "source": "w5",
            "target": "w6"
          },
          {
            "id": "we7",
            "source": "w6",
            "target": "w7"
          },
          {
            "id": "we8",
            "source": "w7",
            "target": "w8"
          },
          {
            "id": "we9",
            "source": "w8",
            "target": "w10",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "we10",
            "source": "w8",
            "target": "w9",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "we11",
            "source": "w9",
            "target": "w12",
            "variant": "error"
          },
          {
            "id": "we12",
            "source": "w10",
            "target": "w11"
          },
          {
            "id": "we13",
            "source": "w11",
            "target": "w12"
          }
        ]
      },
      {
        "id": "flow_escalation",
        "name": "High-Budget Pause Escalation",
        "description": "Handles the manual review flow when a high-budget ad group is flagged for pausing, routing through human approval before executing the action.",
        "nodes": [
          {
            "id": "e1",
            "type": "start",
            "label": "Manual review requested",
            "detail": "Triggered when daily cycle identifies a high-budget (>$500/day) critical ad group"
          },
          {
            "id": "e2",
            "type": "connector",
            "label": "Post escalation to Slack",
            "detail": "POST chat.postMessage with detailed metrics, spend at risk, and approval request",
            "connector": "slack"
          },
          {
            "id": "e3",
            "type": "event",
            "label": "Await review response",
            "detail": "Listen for manual_review_completed event with approve/reject decision"
          },
          {
            "id": "e4",
            "type": "decision",
            "label": "Approved?",
            "detail": "Check if the human reviewer approved or rejected the pause request"
          },
          {
            "id": "e5",
            "type": "connector",
            "label": "Pause ad group",
            "detail": "POST adGroups:mutate to set status=PAUSED",
            "connector": "google_ads"
          },
          {
            "id": "e6",
            "type": "connector",
            "label": "Log approved pause",
            "detail": "Append to 'Paused Log' tab with 'human-approved' flag",
            "connector": "google_sheets"
          },
          {
            "id": "e7",
            "type": "action",
            "label": "Reset counters",
            "detail": "If rejected, reset consecutive-day counter for this ad group and add reviewer note to state"
          },
          {
            "id": "e8",
            "type": "connector",
            "label": "Confirm action in Slack",
            "detail": "Post confirmation of pause execution or rejection acknowledgment",
            "connector": "slack"
          },
          {
            "id": "e9",
            "type": "end",
            "label": "Escalation resolved"
          }
        ],
        "edges": [
          {
            "id": "ee1",
            "source": "e1",
            "target": "e2"
          },
          {
            "id": "ee2",
            "source": "e2",
            "target": "e3"
          },
          {
            "id": "ee3",
            "source": "e3",
            "target": "e4"
          },
          {
            "id": "ee4",
            "source": "e4",
            "target": "e5",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "ee5",
            "source": "e4",
            "target": "e7",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "ee6",
            "source": "e5",
            "target": "e6"
          },
          {
            "id": "ee7",
            "source": "e6",
            "target": "e8"
          },
          {
            "id": "ee8",
            "source": "e7",
            "target": "e8"
          },
          {
            "id": "ee9",
            "source": "e8",
            "target": "e9"
          }
        ]
      }
    ]
  }
}
