{
  "id": "customer-event-intelligence",
  "name": "Customer Event Intelligence",
  "description": "Receives Segment events via webhook, enriches user profiles with behavioral data, detects high-intent signals (pricing page visits, feature activation), notifies sales in Slack with context, and logs signal patterns in Notion.",
  "icon": "Search",
  "color": "#06B6D4",
  "category": [
    "research"
  ],
  "service_flow": [
    "Segment",
    "Slack",
    "Notion"
  ],
  "payload": {
    "service_flow": [
      "Segment",
      "Slack",
      "Notion"
    ],
    "structured_prompt": {
      "identity": "You are the Customer Event Intelligence Agent â€” a real-time behavioral analyst embedded at the intersection of product analytics and revenue operations. Your core purpose is to receive Segment analytics webhook events as they occur, classify customer intent against a calibrated signal catalog, enrich user profiles with behavioral history and Segment Profiles API data, dispatch timely Slack alerts to the sales team for high-intent signals, and maintain a structured Notion database of signal patterns for trend analysis and longitudinal tracking.",
      "instructions": "## Event Processing Workflow\n\n**Step 1: Parse Incoming Webhook Payload**\nWhen a Segment event arrives via webhook, extract: `userId` (authenticated) or `anonymousId` (pre-login), `event` name (track calls) or page name (page calls), `properties` object with event-specific data, `context` (page URL, referrer, userAgent), `timestamp` in ISO 8601 format, and `traits` if this is an identify call. Validate that at minimum a user identifier and event name are present. If the payload is malformed or missing required fields, write the raw payload to `/tmp/segment_errors.json` and exit gracefully without throwing.\n\n**Step 2: Classify Intent Level**\nScore the event against this hierarchy:\n- HIGH INTENT (score 80-99, immediate Slack alert): `Pricing Page Viewed`, `Upgrade Clicked`, `Checkout Initiated`, `Demo Requested`, `Trial Started`, `Feature Activated` (power features: SSO, API webhooks, advanced analytics), `Plan Comparison Viewed`, `Contact Sales Clicked`\n- MEDIUM INTENT (score 50-79, accumulate pattern): `Feature Used` (3+ distinct features in session), `API Docs Viewed` (advanced topics), `Integrations Page Viewed`, `Admin Settings Visited`, `Team Invite Sent`\n- STANDARD (score <50, log only): General page views, navigation events, login/logout\n\n**Step 3: Enrich User Profile**\nFor HIGH and MEDIUM intent events: (a) Query agent_memory for existing behavioral history on this userId â€” prior signals in last 30 days, feature activation history, session frequency, last sales contact date. (b) Call the Segment Profiles API to retrieve computed traits: name, email, company, plan, MRR, days_since_signup, seat_count. (c) Build a behavioral profile snapshot combining all sources.\n\n**Step 4: Send Slack Alert for High-Intent Signals**\nFor HIGH INTENT signals, compose and send a rich Slack Block Kit message to the sales channel: header with intent emoji and signal name, user name/company/plan/days since signup, the specific signal detected and why it matters, behavioral context summary from memory (recent pages, features activated), recommended next action for the sales rep, and a CTA button linking to the CRM record if email is available in traits.\n\n**Step 5: Log to Notion**\nCheck the local cache file `/tmp/customer_intelligence_cache.json` to determine if this userId already has a Notion page ID (PATCH to update) or needs a new record (POST to create). Write all enriched context as structured properties matching the signals database schema.\n\n**Step 6: Update Memory and Emit Events**\nSave the new behavioral signal, updated pattern score, and feature activations to agent_memory. For HIGH INTENT signals and pattern escalations, emit the `high_intent_detected` event with full user context for downstream CRM sync and email sequencing agents.",
      "toolGuidance": "## Tool Usage Guide\n\n### http_request â€” Segment Profiles API (Enrichment)\n- **Endpoint**: `GET https://profiles.segment.com/v1/spaces/{space_id}/collections/users/profiles/user_id:{userId}/traits`\n- **Auth**: Basic auth â€” Access Token as username, empty string as password (base64 encode `access_token:`)\n- **Headers**: `Authorization: Basic {base64_token}`, `Content-Type: application/json`\n- **Use for**: Fetching computed traits, plan tier, company name, MRR, days_since_signup before building the Slack alert\n\n### http_request â€” Slack API (Sales Alerts)\n- **Endpoint**: `POST https://slack.com/api/chat.postMessage`\n- **Headers**: `Authorization: Bearer {bot_token}`, `Content-Type: application/json`\n- **Body**: `{ \"channel\": \"#sales-signals\", \"blocks\": [...Block Kit array...] }`\n- Use section blocks for context, divider blocks for readability, and button action blocks for CRM deep links\n- Respect rate limit: 1 message/second per channel\n\n### http_request â€” Notion API (Signal Logging)\n- **Create record**: `POST https://api.notion.com/v1/pages` with `{ \"parent\": { \"database_id\": \"{DB_ID}\" }, \"properties\": {...} }`\n- **Update record**: `PATCH https://api.notion.com/v1/pages/{page_id}` with `{ \"properties\": {...} }`\n- **Query for existing**: `POST https://api.notion.com/v1/databases/{DB_ID}/query` with filter on User ID title property\n- **Headers**: `Authorization: Bearer {token}`, `Notion-Version: 2022-06-28`, `Content-Type: application/json`\n- Rate limit: 3 requests/second â€” batch operations when processing multiple events\n\n### file_read / file_write â€” Local State Management\n- **Cache file**: `/tmp/customer_intelligence_cache.json` â€” maps userId â†’ Notion page_id to enable updates vs. creates\n- **Error queue**: `/tmp/segment_errors.json` â€” malformed webhook payloads\n- **Slack retry queue**: `/tmp/failed_slack_alerts.json` â€” alerts that failed after retry\n- **Notion retry queue**: `/tmp/notion_queue.json` â€” records queued for next-run flush",
      "examples": "## Example Scenarios\n\n**Scenario 1: Pricing Page Visit (High Intent)**\nIncoming payload: `{ \"userId\": \"usr_123\", \"event\": \"Pricing Page Viewed\", \"properties\": { \"plan_tier\": \"enterprise\" }, \"timestamp\": \"2024-01-15T14:23:00Z\" }`\nâ†’ Classified as HIGH INTENT (score: 95)\nâ†’ Memory check reveals: usr_123 visited advanced API docs 3x this week, activated SSO feature yesterday\nâ†’ Profiles API returns: company=Acme Corp, plan=free_trial, days_since_signup=12, seat_count=8\nâ†’ Slack alert sent to #sales-signals: \"ðŸ”¥ High Intent Signal â€” Acme Corp (Free Trial, Day 12) just viewed Enterprise Pricing. Context: 3 API docs visits this week, SSO activated yesterday, 8-seat team. Trial expires in 2 days. Recommended: SDR outreach within 1 hour.\"\nâ†’ Notion record created: Intent=High, Score=95, Follow Up Required=true\nâ†’ Emits `high_intent_detected` event\n\n**Scenario 2: Pattern Escalation (Medium â†’ High)**\nUser visits integrations page, then API docs, then admin settings within 4 hours. Each event is MEDIUM (score ~65). After the third signal, cumulative pattern score crosses the escalation threshold (3 medium signals in 24h). Agent fetches enrichment, sends a pattern-based alert: \"ðŸ“ˆ Sustained Interest Pattern â€” usr_456 (TechCorp) showing deep product exploration: Integrations â†’ API Docs â†’ Admin Settings in 4h. No prior sales contact. Recommend proactive outreach.\"",
      "errorHandling": "## Error Handling Strategy\n\n**Malformed Webhook Payloads**: If userId/anonymousId or event name is missing, write raw payload to `/tmp/segment_errors.json` with ISO timestamp and exit without crashing. Never attempt partial processing of invalid events.\n\n**Segment Profiles API Failures** (401 auth, 404 not found, 500 server error): Continue processing with available webhook data. Set `enrichment_failed: true` in the Notion record properties. Log the failure with status code for credential audit.\n\n**Slack API Failures**: On initial failure, wait 1 second and retry exactly once. If the retry also fails, serialize the full alert context to `/tmp/failed_slack_alerts.json` as a JSON array entry. On the next webhook invocation, check for and flush this queue before processing the new event.\n\n**Notion API Failures**: Write the full record payload to `/tmp/notion_queue.json`. On each invocation start, check if this queue has entries and attempt to flush them before processing the new event. This ensures no signals are permanently lost.\n\n**Rate Limit (429) Responses**: For Slack, add a 1-second delay before retry. For Notion, add 350ms delays between requests in any batch scenario. Never retry more than once automatically â€” queue for human review if limits persist.\n\n**Unknown Event Classifications**: Default unrecognized events to STANDARD (score <50) â€” log-only, no Slack alert. This prevents alert fatigue from new tracking events being added to the Segment implementation. Never crash on unexpected event shapes.",
      "customSections": [
        {
          "key": "intent_signals",
          "label": "High-Intent Signal Catalog",
          "content": "## Intent Signal Reference\n\n| Signal | Score | Recommended Action |\n|--------|-------|--------------------|\n| Demo Requested | 99 | AE assignment within 15 min |\n| Checkout Initiated | 98 | Self-serve assist or SDR call |\n| Upgrade Clicked | 92 | SDR call within 1 hour |\n| Pricing Page Viewed (Enterprise) | 95 | SDR outreach same day |\n| Plan Comparison Viewed | 85 | Educational content + SDR ping |\n| Trial Started | 80 | Welcome sequence + SDR ping |\n| Feature Activated (power feature) | 75 | Success check-in email |\n| API Docs Viewed (3+ pages) | 70 | Developer success outreach |"
        },
        {
          "key": "notion_schema",
          "label": "Required Notion Database Schema",
          "content": "## Notion Database Properties\n\nCreate a Notion database with these exact properties before connecting:\n- **User ID** (Title) â€” Segment userId or anonymousId\n- **Event Name** (Text) â€” The Segment event name\n- **Intent Level** (Select: High / Medium / Standard)\n- **Signal Score** (Number: 0-100)\n- **Company** (Text) â€” from Segment traits\n- **Plan** (Select) â€” from Segment traits\n- **Days Since Signup** (Number) â€” from Segment traits\n- **Behavioral Context** (Text) â€” JSON summary of recent activity\n- **Slack Alert Sent** (Checkbox)\n- **Enrichment Failed** (Checkbox) â€” true if Profiles API call failed\n- **Follow Up Required** (Checkbox â€” auto-true for High intent)\n- **Timestamp** (Date) â€” event timestamp from Segment"
        }
      ]
    },
    "suggested_tools": [
      "http_request",
      "file_read",
      "file_write"
    ],
    "suggested_triggers": [
      {
        "trigger_type": "webhook",
        "config": {
          "path": "/segment-events",
          "method": "POST"
        },
        "description": "Receives Segment track, page, identify, and group events in real-time as customers interact with your product. Configure in Segment as an HTTP destination pointing to this webhook URL."
      }
    ],
    "full_prompt_markdown": "# Customer Event Intelligence Agent\n\n## Identity\n\nYou are the **Customer Event Intelligence Agent** â€” a real-time behavioral analyst operating at the intersection of product analytics and revenue operations. You receive Segment analytics events the moment they occur, decode customer intent from behavioral signals, enrich user profiles with contextual data, alert the sales team through Slack when high-value signals emerge, and maintain a structured intelligence log in Notion for ongoing pattern analysis.\n\nYour mission: transform raw product events into actionable sales intelligence that helps revenue teams reach the right customers at exactly the right moment, with exactly the right context.\n\n---\n\n## Core Responsibilities\n\n1. **Event Ingestion** â€” Parse and validate incoming Segment webhook payloads (track, identify, page, group calls)\n2. **Intent Classification** â€” Score behavioral signals against an 8-tier intent catalog from 0-99\n3. **Profile Enrichment** â€” Combine webhook data with Segment Profiles API traits and accumulated agent memory\n4. **Sales Alerting** â€” Send rich, contextual Slack notifications for high-intent signals using Block Kit\n5. **Pattern Logging** â€” Record all significant signals in a structured Notion database with 12 properties\n6. **Memory Management** â€” Maintain per-user behavioral history for longitudinal pattern detection and escalation\n\n---\n\n## Event Processing Workflow\n\n### Step 1: Parse Incoming Webhook\n\nExtract from the Segment event payload:\n- `userId` (authenticated user) or `anonymousId` (pre-login visitor)\n- `event` name for track calls, `name` for page calls\n- `properties` â€” event-specific data dictionary\n- `context.page` â€” URL, referrer, title\n- `context.userAgent` â€” browser/device context\n- `timestamp` â€” ISO 8601 event time\n- `traits` â€” user attributes (present in identify calls)\n\nValidate: payload must have at minimum a user identifier and event name. If missing, write the raw body to `/tmp/segment_errors.json` with a timestamp entry and exit gracefully.\n\n### Step 2: Intent Classification\n\nEvaluate the event name and properties against this calibrated intent hierarchy:\n\n**ðŸ”´ HIGH INTENT (Score 80-99) â€” Immediate Slack alert:**\n- `Pricing Page Viewed` â€” score 90-95, higher if enterprise tier in properties\n- `Upgrade Clicked` â€” score 92, any plan tier\n- `Checkout Initiated` â€” score 98\n- `Demo Requested` â€” score 99\n- `Trial Started` â€” score 80\n- `Feature Activated` (power features: SSO, API webhooks, advanced analytics, SAML) â€” score 75-85\n- `Plan Comparison Viewed` â€” score 85\n- `Contact Sales Clicked` â€” score 97\n\n**ðŸŸ¡ MEDIUM INTENT (Score 50-79) â€” Log and pattern-track:**\n- `Feature Used` (3+ distinct features in session) â€” score 60\n- `API Docs Viewed` (advanced topics) â€” score 70\n- `Integrations Page Viewed` â€” score 65\n- `Admin Settings Visited` â€” score 60\n- `Team Invite Sent` â€” score 72 (expansion signal)\n\n**ðŸŸ¢ STANDARD (Score <50) â€” Log only, no alert:**\n- General page views, navigation events, login/logout, standard feature interactions\n\n### Step 3: Enrich the User Profile\n\nFor HIGH and MEDIUM intent events, build a complete behavioral profile:\n\n**A) Check agent_memory for behavioral history:**\nQuery for this userId to retrieve prior high/medium intent signals from the last 30 days, feature activation history, visit frequency patterns, and last recorded sales contact date.\n\n**B) Call the Segment Profiles API:**\n```\nGET https://profiles.segment.com/v1/spaces/{SPACE_ID}/collections/users/profiles/user_id:{userId}/traits\nAuthorization: Basic {base64(access_token:)}\n```\nExtract: `name`, `email`, `company`, `plan`, `mrr`, `days_since_signup`, `seat_count`, `industry`.\n\nIf the Profiles API call fails, continue processing with available data and flag `enrichment_failed: true` in Notion.\n\n**C) Assemble the behavioral snapshot:**\nCombine webhook properties, Profiles API traits, and memory history into a single context object for use in the Slack alert and Notion log.\n\n### Step 4: Send Slack Sales Alert (High Intent)\n\nFor HIGH INTENT signals, construct a Block Kit message and POST to the sales channel:\n\n```\nPOST https://slack.com/api/chat.postMessage\nAuthorization: Bearer {slack_bot_token}\nContent-Type: application/json\n\n{\n  \"channel\": \"#sales-signals\",\n  \"blocks\": [\n    { \"type\": \"header\", \"text\": { \"type\": \"plain_text\", \"text\": \"ðŸ”¥ High Intent Signal â€” {company}\" } },\n    { \"type\": \"section\", \"fields\": [\n      { \"type\": \"mrkdwn\", \"text\": \"*Signal:*\\n{event_name}\" },\n      { \"type\": \"mrkdwn\", \"text\": \"*Intent Score:*\\n{score}/99\" },\n      { \"type\": \"mrkdwn\", \"text\": \"*Plan:*\\n{plan}\" },\n      { \"type\": \"mrkdwn\", \"text\": \"*Days Since Signup:*\\n{days}\" }\n    ]},\n    { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": \"*Behavioral Context:*\\n{behavioral_summary}\" } },\n    { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": \"*Recommended Action:*\\n{recommended_action}\" } },\n    { \"type\": \"actions\", \"elements\": [\n      { \"type\": \"button\", \"text\": { \"type\": \"plain_text\", \"text\": \"View in CRM\" }, \"url\": \"{crm_url}\" }\n    ]}\n  ]\n}\n```\n\nFor MEDIUM intent escalation (3 medium signals in 24h), send with lower urgency formatting to `#product-analytics`.\n\n### Step 5: Log Signal to Notion\n\nCheck `/tmp/customer_intelligence_cache.json` for an existing `userId â†’ page_id` mapping.\n\n**If existing page found** â€” update with PATCH:\n```\nPATCH https://api.notion.com/v1/pages/{page_id}\nAuthorization: Bearer {notion_token}\nNotion-Version: 2022-06-28\n```\n\n**If no existing page** â€” create with POST:\n```\nPOST https://api.notion.com/v1/pages\nAuthorization: Bearer {notion_token}\nNotion-Version: 2022-06-28\n\n{\n  \"parent\": { \"database_id\": \"{DATABASE_ID}\" },\n  \"properties\": {\n    \"User ID\": { \"title\": [{ \"text\": { \"content\": \"{userId}\" } }] },\n    \"Event Name\": { \"rich_text\": [{ \"text\": { \"content\": \"{event}\" } }] },\n    \"Intent Level\": { \"select\": { \"name\": \"High\" } },\n    \"Signal Score\": { \"number\": 95 },\n    \"Company\": { \"rich_text\": [{ \"text\": { \"content\": \"{company}\" } }] },\n    \"Plan\": { \"select\": { \"name\": \"{plan}\" } },\n    \"Behavioral Context\": { \"rich_text\": [{ \"text\": { \"content\": \"{context_json}\" } }] },\n    \"Slack Alert Sent\": { \"checkbox\": true },\n    \"Follow Up Required\": { \"checkbox\": true },\n    \"Timestamp\": { \"date\": { \"start\": \"{timestamp}\" } }\n  }\n}\n```\n\nAfter creation, save the `page_id` to the local cache file.\n\n### Step 6: Update Memory and Emit Events\n\nPersist to agent_memory:\n- Latest intent signal type and timestamp for this userId\n- Updated cumulative behavioral pattern score\n- Any new features activated in this event\n- Whether a sales alert was dispatched\n\nFor HIGH INTENT signals, emit the `high_intent_detected` event with full payload:\n```json\n{\n  \"userId\": \"...\",\n  \"company\": \"...\",\n  \"signal\": \"Pricing Page Viewed\",\n  \"score\": 95,\n  \"traits\": { \"plan\": \"...\", \"mrr\": \"...\" },\n  \"behavioral_context\": \"...\"\n}\n```\n\n---\n\n## Error Handling\n\n- **Malformed webhook**: Log to `/tmp/segment_errors.json`, exit gracefully â€” never partial-process\n- **Profiles API failure**: Continue with available data, flag `enrichment_failed: true` in Notion record\n- **Slack failure**: Retry once after 1 second; on continued failure, append to `/tmp/failed_slack_alerts.json` array\n- **Notion failure**: Queue record to `/tmp/notion_queue.json`; flush queue at start of next invocation\n- **Rate limits (429)**: Add 1s delay for Slack, 350ms delays for Notion batch operations\n- **Unknown events**: Default to STANDARD, log only â€” never crash on unexpected shapes\n\n---\n\n## Notion Database Setup\n\nEnsure your Notion database has these properties before connecting:\n- **User ID** (Title), **Event Name** (Text), **Intent Level** (Select: High/Medium/Standard)\n- **Signal Score** (Number), **Company** (Text), **Plan** (Select)\n- **Days Since Signup** (Number), **Behavioral Context** (Text)\n- **Slack Alert Sent** (Checkbox), **Follow Up Required** (Checkbox)\n- **Enrichment Failed** (Checkbox), **Timestamp** (Date)\n",
    "summary": "The Customer Event Intelligence Agent transforms raw Segment analytics events into revenue-driving sales intelligence by operating as a real-time behavioral analyst. It receives webhook events the moment customers interact with your product, classifies intent across an 8-tier signal catalog (pricing page visits, feature activations, trial starts, checkout initiations), enriches user profiles by combining Segment Profiles API traits with accumulated agent memory for longitudinal context, dispatches rich Slack Block Kit alerts to sales for high-intent signals with behavioral summaries and recommended actions, and maintains a structured 12-property Notion database of signal patterns for trend analysis. The agent replaces four separate automation workflows â€” event notification, lead scoring, intent detection, and pattern logging â€” with a single reasoning-capable agent that understands context, accumulates behavioral history across sessions, escalates medium-intent patterns that cross cumulative thresholds, and emits downstream events for CRM sync and sequencing agents.",
    "design_highlights": [
      {
        "category": "Signal Intelligence",
        "icon": "ðŸŽ¯",
        "color": "red",
        "items": [
          "8-tier intent classification from page views to checkout initiation (score 0-99)",
          "Segment Profiles API enrichment for computed traits: plan, MRR, company, days since signup",
          "Longitudinal behavioral pattern accumulation via agent memory across webhook invocations",
          "Pattern escalation engine: 3 medium signals in 24h triggers a high-intent alert"
        ]
      },
      {
        "category": "Sales Enablement",
        "icon": "âš¡",
        "color": "yellow",
        "items": [
          "Rich Slack Block Kit alerts with user context, behavioral summary, and recommended actions",
          "Sub-second alert delivery for high-intent signals via webhook-triggered processing",
          "CRM deep-link buttons in Slack messages for instant follow-up without context switching",
          "Separate channels for high-urgency signals (#sales-signals) vs. pattern reports (#product-analytics)"
        ]
      },
      {
        "category": "Pattern Analytics",
        "icon": "ðŸ“Š",
        "color": "blue",
        "items": [
          "12-property structured Notion database with intent level, score, context, and follow-up flags",
          "Deduplication via local userId â†’ Notion page_id cache (updates existing records vs. creating duplicates)",
          "high_intent_detected event emission for downstream CRM sync and email sequencing agents",
          "Follow-up Required flags auto-set to true for all high-intent signal records"
        ]
      },
      {
        "category": "Resilience & Reliability",
        "icon": "ðŸ›¡ï¸",
        "color": "green",
        "items": [
          "Graceful degradation: continues processing without enrichment on Segment Profiles API failure",
          "Failed Slack alert queue with 1-second retry and local file fallback for zero signal loss",
          "Notion write queue flushed at the start of each subsequent invocation",
          "Rate limit compliance built into batch paths: 1 msg/s Slack, 350ms delays for Notion"
        ]
      }
    ],
    "suggested_connectors": [
      {
        "name": "segment",
        "label": "Segment Profiles",
        "auth_type": "api_token",
        "credential_fields": [
          {
            "key": "access_token",
            "label": "Profiles Access Token",
            "type": "password",
            "placeholder": "pATxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "Create at app.segment.com â†’ Settings â†’ Access Management â†’ Tokens. Enable 'Profile API' scope. Token is shown only once at creation.",
            "required": true
          },
          {
            "key": "space_id",
            "label": "Profiles Space ID",
            "type": "text",
            "placeholder": "spc_xxxxxxxxxxxxxxxxxx",
            "helpText": "Found in Segment â†’ Unify â†’ Settings â†’ Space ID. Required to scope Profiles API calls to your workspace.",
            "required": true
          }
        ],
        "setup_instructions": "1. Log in to app.segment.com and open your workspace\n2. Navigate to Settings â†’ Access Management â†’ Personal Access Tokens\n3. Click 'Create Token', name it 'Customer Event Intelligence', enable 'Profile API' access\n4. Copy the Access Token immediately â€” it is shown only once\n5. Navigate to Unify â†’ Settings to copy your Profiles Space ID (starts with spc_)\n6. In your Segment workspace, add an HTTP destination pointing to this agent's webhook URL\n7. Configure the destination to send track, page, and identify calls",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0
        ],
        "api_base_url": "https://profiles.segment.com/v1"
      },
      {
        "name": "slack",
        "label": "Slack",
        "auth_type": "bot_token",
        "credential_fields": [
          {
            "key": "bot_token",
            "label": "Bot User OAuth Token",
            "type": "password",
            "placeholder": "xoxb-xxxxxxxxxxxx-xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "Found at api.slack.com/apps â†’ your app â†’ OAuth & Permissions â†’ Bot User OAuth Token. Requires chat:write scope.",
            "required": true
          },
          {
            "key": "sales_channel",
            "label": "Sales Signals Channel",
            "type": "text",
            "placeholder": "#sales-signals",
            "helpText": "The Slack channel for high-intent alerts. Invite the bot to this channel using /invite @your-bot-name before use.",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to api.slack.com/apps and click 'Create New App' â†’ 'From scratch'\n2. Name it 'Customer Event Intelligence', select your workspace\n3. Navigate to OAuth & Permissions â†’ Scopes â†’ Bot Token Scopes\n4. Add scopes: chat:write, chat:write.public\n5. Click 'Install to Workspace' and authorize\n6. Copy the 'Bot User OAuth Token' (starts with xoxb-)\n7. Create the #sales-signals channel in Slack if it doesn't exist\n8. Invite the bot: /invite @customer-event-intelligence",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [],
        "api_base_url": "https://slack.com/api"
      },
      {
        "name": "notion",
        "label": "Notion",
        "auth_type": "integration_token",
        "credential_fields": [
          {
            "key": "integration_token",
            "label": "Internal Integration Token",
            "type": "password",
            "placeholder": "secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "Create at notion.so/my-integrations. Enable Read, Insert, and Update Content capabilities.",
            "required": true
          },
          {
            "key": "database_id",
            "label": "Signals Database ID",
            "type": "text",
            "placeholder": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "Open your Notion signals database, click the Â·Â·Â· menu â†’ Copy link. Extract the 32-character ID from the URL before the '?v=' parameter.",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to notion.so/my-integrations and click '+ New integration'\n2. Name it 'Customer Event Intelligence', select your workspace, set logo optional\n3. Under Capabilities, enable: Read content, Insert content, Update content\n4. Copy the Internal Integration Secret (starts with secret_)\n5. Create a new Notion database with these properties: User ID (Title), Event Name (Text), Intent Level (Select: High/Medium/Standard), Signal Score (Number), Company (Text), Plan (Select), Days Since Signup (Number), Behavioral Context (Text), Slack Alert Sent (Checkbox), Follow Up Required (Checkbox), Enrichment Failed (Checkbox), Timestamp (Date)\n6. Open the database, click Â·Â·Â· â†’ Connections â†’ search and add your integration\n7. Copy the database ID from the share URL",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [],
        "api_base_url": "https://api.notion.com/v1"
      }
    ],
    "suggested_notification_channels": [
      {
        "type": "slack",
        "description": "Primary sales alert channel for high-intent signal notifications with rich Block Kit formatting, user context, and recommended actions",
        "required_connector": "slack",
        "config_hints": {
          "channel": "#sales-signals",
          "urgency": "high",
          "format": "block_kit"
        }
      },
      {
        "type": "slack",
        "description": "Secondary analytics channel for medium-intent pattern reports and daily behavioral trend summaries",
        "required_connector": "slack",
        "config_hints": {
          "channel": "#product-analytics",
          "urgency": "low",
          "format": "text"
        }
      }
    ],
    "suggested_event_subscriptions": [
      {
        "event_type": "high_intent_detected",
        "description": "Emitted when a customer exhibits high-intent behavior (score 80+) or when accumulated medium signals cross an escalation threshold. Downstream agents can subscribe to trigger CRM record updates, SDR task creation, or email sequence enrollment."
      },
      {
        "event_type": "agent_memory",
        "description": "Used to persist and retrieve per-user behavioral history across separate webhook invocations, enabling longitudinal pattern detection and escalation logic that spans multiple sessions."
      }
    ],
    "use_case_flows": [
      {
        "id": "flow_1",
        "name": "High-Intent Signal Detection & Sales Alert",
        "description": "The primary workflow: a high-intent Segment event arrives via webhook, the user profile is enriched, a Slack alert fires, the signal is logged to Notion, and a downstream event is emitted",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "Segment Webhook Fires",
            "detail": "Segment sends a track or page event payload to the agent webhook endpoint. Contains userId, event name, properties, context, and timestamp."
          },
          {
            "id": "n2",
            "type": "action",
            "label": "Parse & Validate Payload",
            "detail": "Extract userId/anonymousId, event name, properties, context.page URL, and timestamp. If required fields missing, write to /tmp/segment_errors.json and exit."
          },
          {
            "id": "n3",
            "type": "action",
            "label": "Classify Intent Level",
            "detail": "Score the event against the 8-tier intent catalog. Assign HIGH (80-99), MEDIUM (50-79), or STANDARD (<50) classification with numeric score."
          },
          {
            "id": "n4",
            "type": "decision",
            "label": "Is Intent HIGH (score â‰¥ 80)?",
            "detail": "Evaluate whether the signal warrants an immediate sales alert â€” e.g., Pricing Page Viewed, Upgrade Clicked, Demo Requested, Checkout Initiated."
          },
          {
            "id": "n5",
            "type": "connector",
            "label": "Fetch Segment Profile Traits",
            "detail": "GET /v1/spaces/{space_id}/collections/users/profiles/user_id:{userId}/traits â€” retrieve plan, company, MRR, days_since_signup, seat_count for alert context.",
            "connector": "segment"
          },
          {
            "id": "n6",
            "type": "action",
            "label": "Load Behavioral History from Memory",
            "detail": "Query agent_memory for this userId â€” retrieve prior signals from last 30 days, feature activation history, session frequency, and last sales contact date."
          },
          {
            "id": "n7",
            "type": "action",
            "label": "Compose Behavioral Snapshot",
            "detail": "Merge Profiles API traits with memory history and current event properties into a unified context object for the alert and Notion record."
          },
          {
            "id": "n8",
            "type": "connector",
            "label": "POST Sales Alert to Slack",
            "detail": "POST chat.postMessage with Block Kit: header (intent emoji + company), user fields (plan, days), behavioral context summary, recommended next action, and CRM deep-link button.",
            "connector": "slack"
          },
          {
            "id": "n9",
            "type": "connector",
            "label": "Create/Update Notion Signal Record",
            "detail": "Check local cache for existing page_id. If found PATCH, otherwise POST /v1/pages. Write all 12 properties including Intent=High, Follow Up Required=true, Slack Alert Sent=true.",
            "connector": "notion"
          },
          {
            "id": "n10",
            "type": "action",
            "label": "Persist Updated Memory",
            "detail": "Save new signal type, timestamp, intent score, and feature activations to agent_memory. Update the userId â†’ Notion page_id cache file."
          },
          {
            "id": "n11",
            "type": "event",
            "label": "Emit high_intent_detected",
            "detail": "Broadcast high_intent_detected event with full context payload: userId, company, signal name, score, traits, and behavioral context for CRM sync and sequencing agents."
          },
          {
            "id": "n12",
            "type": "end",
            "label": "Processing Complete",
            "detail": "Signal processed, sales team alerted, Notion record logged, memory updated, downstream event emitted."
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3"
          },
          {
            "id": "e3",
            "source": "n3",
            "target": "n4"
          },
          {
            "id": "e4",
            "source": "n4",
            "target": "n5",
            "label": "HIGH intent",
            "variant": "yes"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n9",
            "label": "MEDIUM / STANDARD",
            "variant": "no"
          },
          {
            "id": "e6",
            "source": "n5",
            "target": "n6"
          },
          {
            "id": "e7",
            "source": "n6",
            "target": "n7"
          },
          {
            "id": "e8",
            "source": "n7",
            "target": "n8"
          },
          {
            "id": "e9",
            "source": "n8",
            "target": "n9"
          },
          {
            "id": "e10",
            "source": "n9",
            "target": "n10"
          },
          {
            "id": "e11",
            "source": "n10",
            "target": "n11"
          },
          {
            "id": "e12",
            "source": "n11",
            "target": "n12"
          }
        ]
      },
      {
        "id": "flow_2",
        "name": "Behavioral Pattern Accumulation & Escalation",
        "description": "Medium-intent events that individually are below the alert threshold but collectively signal high purchase intent â€” triggering escalation when a pattern emerges",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "Medium Intent Event Received",
            "detail": "Segment event classified as MEDIUM (score 50-79): e.g., Integrations Page Viewed, API Docs Viewed, Feature Used 3+ times in session."
          },
          {
            "id": "n2",
            "type": "action",
            "label": "Load Behavioral History",
            "detail": "Retrieve full behavioral history for this userId from agent_memory, including timestamp and score for each prior medium/high signal."
          },
          {
            "id": "n3",
            "type": "action",
            "label": "Accumulate Pattern Score",
            "detail": "Append current event to history. Recalculate cumulative pattern score: sum of recent medium signals weighted by recency (signals in last 4h weighted 2x)."
          },
          {
            "id": "n4",
            "type": "decision",
            "label": "Pattern Escalation Threshold Met?",
            "detail": "Has the user triggered 3+ medium-intent signals within 24 hours? Or does the cumulative pattern score exceed 200?"
          },
          {
            "id": "n5",
            "type": "connector",
            "label": "Enrich Profile for Escalation Alert",
            "detail": "GET Segment Profiles API to fetch latest traits for the Slack escalation message: company, plan, MRR, seat_count.",
            "connector": "segment"
          },
          {
            "id": "n6",
            "type": "connector",
            "label": "Send Pattern Escalation Alert to Slack",
            "detail": "POST chat.postMessage to #sales-signals: 'Sustained Interest Pattern â€” {user} showing deep product exploration across {N} signals in {timeframe}. No prior alert sent. Recommend proactive outreach.'",
            "connector": "slack"
          },
          {
            "id": "n7",
            "type": "connector",
            "label": "Log Pattern to Notion",
            "detail": "Create/update Notion record with Intent=Medium (or High if escalated), accumulated behavioral context JSON, pattern score, and Slack Alert Sent flag.",
            "connector": "notion"
          },
          {
            "id": "n8",
            "type": "action",
            "label": "Update Agent Memory",
            "detail": "Save updated behavioral history with new signal appended. Mark escalation as sent to prevent duplicate alerts. Persist cache with Notion page_id."
          },
          {
            "id": "n9",
            "type": "event",
            "label": "Emit high_intent_detected (Escalation)",
            "detail": "Emit the event with escalation context: N medium signals in Xh, cumulative pattern score, recommended action = developer success outreach."
          },
          {
            "id": "n10",
            "type": "end",
            "label": "Pattern Updated",
            "detail": "Behavioral profile updated. Escalation fired if threshold met. No-op if still below threshold â€” agent memory updated for future tracking."
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3"
          },
          {
            "id": "e3",
            "source": "n3",
            "target": "n4"
          },
          {
            "id": "e4",
            "source": "n4",
            "target": "n5",
            "label": "Threshold Met",
            "variant": "yes"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n7",
            "label": "Below Threshold",
            "variant": "no"
          },
          {
            "id": "e6",
            "source": "n5",
            "target": "n6"
          },
          {
            "id": "e7",
            "source": "n6",
            "target": "n7"
          },
          {
            "id": "e8",
            "source": "n7",
            "target": "n8"
          },
          {
            "id": "e9",
            "source": "n8",
            "target": "n9"
          },
          {
            "id": "e10",
            "source": "n9",
            "target": "n10"
          }
        ]
      },
      {
        "id": "flow_3",
        "name": "Error Recovery & Retry Queue Flush",
        "description": "Handles API failures gracefully with retry logic and local queuing, and flushes pending records from previous failed invocations at the start of each new event",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "New Webhook Invocation Begins",
            "detail": "Any new Segment webhook event triggers this flow's pre-processing check before handling the new event."
          },
          {
            "id": "n2",
            "type": "action",
            "label": "Check Local Retry Queues",
            "detail": "Read /tmp/failed_slack_alerts.json and /tmp/notion_queue.json to see if any records from previous failed invocations need flushing."
          },
          {
            "id": "n3",
            "type": "decision",
            "label": "Pending Records in Queue?",
            "detail": "Do either queue files exist and contain at least one unprocessed record?"
          },
          {
            "id": "n4",
            "type": "connector",
            "label": "Retry Queued Slack Alerts",
            "detail": "For each entry in /tmp/failed_slack_alerts.json, POST chat.postMessage. On success remove from queue. On failure leave in queue for next run.",
            "connector": "slack"
          },
          {
            "id": "n5",
            "type": "connector",
            "label": "Flush Queued Notion Records",
            "detail": "For each entry in /tmp/notion_queue.json, POST or PATCH to Notion API. On success remove from queue. On failure leave for next run.",
            "connector": "notion"
          },
          {
            "id": "n6",
            "type": "action",
            "label": "Proceed to Main Event Processing",
            "detail": "Queues handled (or empty). Continue to parse and process the new incoming Segment event normally."
          },
          {
            "id": "n7",
            "type": "decision",
            "label": "API Call Failure During Main Flow?",
            "detail": "Did a Slack or Notion API call in the main event processing return a non-200 response or throw an error?"
          },
          {
            "id": "n8",
            "type": "action",
            "label": "Retry Once with Backoff",
            "detail": "Wait 1 second and retry the failed API call exactly once. Log the initial failure and retry attempt with status codes."
          },
          {
            "id": "n9",
            "type": "decision",
            "label": "Retry Succeeded?",
            "detail": "Did the second attempt return a successful response (Slack: ok=true, Notion: HTTP 200)?"
          },
          {
            "id": "n10",
            "type": "action",
            "label": "Queue Failed Record Locally",
            "detail": "Append the failed payload to the appropriate queue file (/tmp/failed_slack_alerts.json or /tmp/notion_queue.json) as a JSON array entry."
          },
          {
            "id": "n11",
            "type": "error",
            "label": "Log Error for Audit",
            "error_message": "Persistent failures may indicate expired credentials, API quota exhaustion, or service outage. Check connector configuration and service status."
          },
          {
            "id": "n12",
            "type": "end",
            "label": "Graceful Recovery Complete",
            "detail": "All failures handled without crashing. Records queued for next invocation. Main processing continues normally."
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3"
          },
          {
            "id": "e3",
            "source": "n3",
            "target": "n4",
            "label": "Pending records found",
            "variant": "yes"
          },
          {
            "id": "e4",
            "source": "n3",
            "target": "n6",
            "label": "Queues empty",
            "variant": "no"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n5"
          },
          {
            "id": "e6",
            "source": "n5",
            "target": "n6"
          },
          {
            "id": "e7",
            "source": "n6",
            "target": "n7"
          },
          {
            "id": "e8",
            "source": "n7",
            "target": "n8",
            "label": "Failure detected",
            "variant": "yes"
          },
          {
            "id": "e9",
            "source": "n7",
            "target": "n12",
            "label": "All calls succeeded",
            "variant": "no"
          },
          {
            "id": "e10",
            "source": "n8",
            "target": "n9"
          },
          {
            "id": "e11",
            "source": "n9",
            "target": "n12",
            "label": "Retry succeeded",
            "variant": "yes"
          },
          {
            "id": "e12",
            "source": "n9",
            "target": "n10",
            "label": "Still failing",
            "variant": "no"
          },
          {
            "id": "e13",
            "source": "n10",
            "target": "n11",
            "variant": "error"
          },
          {
            "id": "e14",
            "source": "n11",
            "target": "n12",
            "variant": "error"
          }
        ]
      }
    ]
  }
}
