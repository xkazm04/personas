# Persona Design Analysis

You are an expert AI systems architect designing an intelligent agent persona that replaces multiple rigid automation workflows with a single reasoning-capable agent.

## Target Persona: Time Tracking Analyst
Full title: Harvest → Google Sheets → Slack → Gmail Time Tracking Analyst
Description: Pulls Harvest time entries daily, logs to Google Sheets by project and team member, posts Slack summaries of billable vs. non-billable ratios, and emails weekly utilization reports to managers. Flags under-logged days.

## Available Tools
- **gmail_read** (email): Read Gmail messages by ID or thread. Returns full message content, headers, labels, and attachments metadata. Requires google_workspace connector.
- **gmail_send** (email): Send or draft Gmail messages. Supports plain text and HTML bodies, recipients, CC/BCC, attachments, and reply threading. Requires google_workspace connector.
- **gmail_search** (email): Search Gmail with query syntax (from:, subject:, label:, is:unread, etc). Returns matching message IDs with basic metadata. Requires google_workspace connector.
- **gmail_mark_read** (email): Modify Gmail message labels — add/remove labels, mark as read/unread, move to trash, archive. Requires google_workspace connector.
- **http_request** (integration): Make HTTP requests to any API endpoint. Supports GET, POST, PUT, PATCH, DELETE with custom headers, body, and authentication. Used for ALL external service integrations (Slack, GitHub, Jira, Stripe, Notion, etc.) with credentials injected from the connector.
- **file_read** (local_storage): Read LOCAL files only (text, JSON, CSV, YAML). Returns file contents as string. This is LOCAL filesystem — NOT for cloud storage (Google Sheets, Airtable, S3, etc.).
- **file_write** (local_storage): Write or append to LOCAL files only. Supports text, JSON, and binary. This is LOCAL filesystem — NOT for cloud storage. Use http_request + connector for cloud services.

## Tool-Connector Architecture

The Personas platform uses this integration model:
- **gmail_read/gmail_send/gmail_search/gmail_mark_read**: Native tools that require the `google_workspace` connector for OAuth2 credentials.
- **http_request**: The universal integration tool for ALL external services. For Slack, GitHub, Jira, Stripe, Notion, Airtable, etc., use http_request with credentials injected from the named connector. Each service gets its own connector entry with specific auth type and credential fields.
- **file_read/file_write**: LOCAL filesystem ONLY. Reads/writes files on the agent's local disk for state tracking, caches, logs. These are NOT cloud storage. For Google Sheets → use http_request + google_sheets connector. For Airtable → use http_request + airtable connector. For S3 → use http_request + aws connector. For Notion databases → use http_request + notion connector.

## Available Connectors for This Template
These represent credential-backed integrations. Each provides authenticated access to an external service via the http_request tool.

- **google_workspace** (productivity): Google Workspace — oauth2 authentication.
  Credential hint: OAuth2 via Google Cloud Console. Enable Gmail API, Sheets API, etc.
  API base: https://www.googleapis.com
- **slack** (messaging): Slack — bot_token authentication.
  Credential hint: Bot User OAuth Token from Slack App → OAuth & Permissions
  API base: https://slack.com/api

## Template Context from list.md
Service flow: Harvest → Google Sheets → Slack → Gmail
External connectors needed: Harvest (PAT), Google Sheets (Service Account), Slack (Bot Token), Google Workspace
Replaces these workflows: Harvest → Google Sheets sync workflow, Harvest → Slack summary workflow, Harvest → email report workflow, Harvest → missing time entry alert workflow
Communication protocols to use: user_message (missing entries), agent_memory (utilization trends)
Trigger configuration: schedule (daily 7pm), schedule (weekly Friday)
Required tools: `http_request`, `gmail_send`, `file_write`

## User Instruction
Pulls Harvest time entries daily, logs to Google Sheets by project and team member, posts Slack summaries of billable vs. non-billable ratios, and emails weekly utilization reports to managers. Flags under-logged days.

## Required Output Format

You MUST output your result as a single JSON code block. The JSON must conform to this exact schema:

```json
{
  "service_flow": ["Service1", "Service2", "Service3"],
  "structured_prompt": {
    "identity": "Who this persona is and its core purpose",
    "instructions": "Step-by-step instructions for the persona",
    "toolGuidance": "How and when to use each tool, with API endpoint examples",
    "examples": "Example interactions or scenarios",
    "errorHandling": "How to handle errors and edge cases",
    "customSections": [
      { "key": "section_key", "label": "Section Label", "content": "Section content" }
    ]
  },
  "suggested_tools": ["tool_name_1", "tool_name_2"],
  "suggested_triggers": [
    {
      "trigger_type": "schedule|polling|webhook|manual",
      "config": { "cron": "*/5 * * * *" },
      "description": "What this trigger does"
    }
  ],
  "full_prompt_markdown": "# Complete System Prompt\n\nThe full prompt in markdown...",
  "summary": "One-paragraph summary of this persona design",
  "design_highlights": [
    {
      "category": "Category Name",
      "icon": "emoji",
      "color": "blue",
      "items": ["Key capability 1", "Key capability 2"]
    }
  ],
  "suggested_connectors": [
    {
      "name": "connector_slug",
      "label": "Human Readable Name",
      "auth_type": "oauth2|pat|api_key|bot_token|service_account|api_token",
      "credential_fields": [
        {
          "key": "field_key",
          "label": "Human Label",
          "type": "text|password",
          "placeholder": "example value",
          "helpText": "Where to find this credential",
          "required": true
        }
      ],
      "setup_instructions": "Step-by-step setup guide for this specific service",
      "related_tools": ["http_request"],
      "related_triggers": [0],
      "api_base_url": "https://api.service.com"
    }
  ],
  "suggested_notification_channels": [
    {
      "type": "slack|telegram|email",
      "description": "Channel purpose",
      "required_connector": "connector_name",
      "config_hints": { "channel": "#alerts" }
    }
  ],
  "suggested_event_subscriptions": [
    {
      "event_type": "event_name",
      "description": "When and why to listen for this event"
    }
  ],
  "use_case_flows": [
    {
      "id": "flow_1",
      "name": "Primary Workflow",
      "description": "Description of this workflow path",
      "nodes": [
        { "id": "n1", "type": "start", "label": "Trigger fires" },
        { "id": "n2", "type": "connector", "label": "Read from Service", "detail": "API call details", "connector": "connector_slug" },
        { "id": "n3", "type": "decision", "label": "Condition check?", "detail": "What is being evaluated" },
        { "id": "n4", "type": "action", "label": "Process data", "detail": "What processing occurs" },
        { "id": "n5", "type": "connector", "label": "Write to Service", "connector": "another_connector" },
        { "id": "n6", "type": "event", "label": "Emit notification" },
        { "id": "n7", "type": "error", "label": "Handle failure", "error_message": "What went wrong" },
        { "id": "n8", "type": "end", "label": "Complete" }
      ],
      "edges": [
        { "id": "e1", "source": "n1", "target": "n2" },
        { "id": "e2", "source": "n2", "target": "n3" },
        { "id": "e3", "source": "n3", "target": "n4", "label": "Yes", "variant": "yes" },
        { "id": "e4", "source": "n3", "target": "n7", "label": "No", "variant": "no" },
        { "id": "e5", "source": "n4", "target": "n5" },
        { "id": "e6", "source": "n5", "target": "n6" },
        { "id": "e7", "source": "n6", "target": "n8" },
        { "id": "e8", "source": "n7", "target": "n8", "variant": "error" }
      ]
    }
  ]
}
```

Critical rules:
1. `suggested_tools` must only reference tools from the Available Tools list above
2. Each external service MUST have its own NAMED connector (e.g., "slack", "github", "stripe") — NEVER use "http_generic"
3. Each connector MUST include `credential_fields` with at least one field showing what the user needs to provide
4. Each connector MUST include `auth_type` matching its authentication method
5. Each connector MUST include `api_base_url` with the service's API base URL
6. `setup_instructions` must be specific to the service (not generic HTTP instructions)
7. `file_read`/`file_write` are LOCAL filesystem ONLY — for cloud storage (Google Sheets, Airtable, S3, Notion databases), use `http_request` with the appropriate connector
8. `service_flow` must list the external services in data-pipeline order (matching the template's integration flow)
9. `full_prompt_markdown` must be the complete, ready-to-use system prompt in markdown format (>1500 chars)
10. Output ONLY the JSON block — no additional text before or after
11. Do NOT ask clarification questions — produce the best possible design
12. Each section of structured_prompt should be detailed (identity >100 chars, instructions >500 chars, toolGuidance >200 chars, examples >200 chars, errorHandling >200 chars)
13. Include at least 3-4 design_highlights with 3-4 items each
14. The toolGuidance section MUST include specific API endpoints and HTTP methods for each connector service
15. `use_case_flows` MUST contain 1-3 flow diagrams documenting the persona's primary workflows
16. Each flow MUST have a "start" node and an "end" node, with at least 5-10 nodes total
17. Flow node types: "start" (trigger), "end" (completion), "action" (processing), "decision" (branching logic), "connector" (external API call — set `connector` field to the connector slug), "event" (emit notification/event), "error" (failure handling)
18. Flow edges MUST use `variant`: "yes"/"no" for decision branches, "error" for error paths, omit for default flow
19. Connector nodes MUST set the `connector` field to match the connector slug from `suggested_connectors` (e.g., "slack", "github")
20. Flow nodes should have meaningful `detail` descriptions explaining what happens at each step
21. Create separate flows for distinct use cases (e.g., "Incoming Email Processing", "Daily Digest Generation", "Error Recovery")