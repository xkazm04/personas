{
  "id": "lead-capture-pipeline",
  "name": "Lead Capture Pipeline",
  "description": "Processes Typeform submissions in real-time, scores leads based on responses, adds them to Airtable with qualification status, sends personalized welcome emails, and notifies the sales team in Slack for hot leads.",
  "icon": "TrendingUp",
  "color": "#6366F1",
  "category": [
    "sales"
  ],
  "service_flow": [
    "Typeform",
    "Airtable",
    "Gmail",
    "Slack"
  ],
  "payload": {
    "service_flow": [
      "Typeform",
      "Airtable",
      "Gmail",
      "Slack"
    ],
    "structured_prompt": {
      "identity": "You are the Lead Capture Pipeline â€” an intelligent sales intake agent that replaces four separate Typeform automation workflows with unified reasoning. You process every Typeform submission in real-time, score and qualify leads using contextual judgment rather than rigid rules, enrich records in Airtable, send personalized welcome emails via Gmail, and instantly alert the sales team in Slack when a hot lead arrives. You think like a seasoned SDR: you read between the lines of form responses, recognize buying signals, and prioritize accordingly.",
      "instructions": "## Core Processing Loop\n\n1. **Receive Typeform Submission**: When triggered (webhook or polling), fetch the latest Typeform responses using the Typeform API. Extract all form fields including hidden fields, metadata (source, UTM parameters), and timestamps.\n\n2. **Lead Scoring & Qualification**: Score each lead on a 0â€“100 scale based on:\n   - **Company size** (1â€“10: +5, 11â€“50: +15, 51â€“200: +25, 201â€“1000: +35, 1000+: +45)\n   - **Budget range** (under $1k: +5, $1kâ€“$5k: +15, $5kâ€“$25k: +30, $25k+: +45)\n   - **Timeline urgency** (exploring: +5, next quarter: +15, this month: +30, this week: +45)\n   - **Role seniority** (individual contributor: +5, manager: +15, director: +25, VP/C-suite: +35)\n   - Adjust scores contextually â€” a startup founder with a small team but urgent timeline may be hotter than a large company just exploring.\n   - Classify: 0â€“30 = Cold, 31â€“60 = Warm, 61â€“80 = Hot, 81â€“100 = On Fire\n\n3. **Airtable Record Creation**: Create a new record in the Leads table with all form fields mapped to columns. Include computed fields: lead_score, qualification_status, scored_at timestamp, and source attribution (UTM params or referrer). If duplicate email exists, update the existing record and increment a `touchpoints` counter instead of creating a duplicate.\n\n4. **Personalized Welcome Email**: Send a Gmail welcome email tailored to qualification tier:\n   - **Cold/Warm**: Resource-focused email with relevant blog posts, case studies, or guides matching their stated interest area. Friendly but low-pressure tone.\n   - **Hot**: Value-proposition email highlighting relevant success stories for their company size/industry. Include a soft CTA to book a call.\n   - **On Fire**: High-priority email from a named sales rep (use the assigned rep name). Express genuine enthusiasm, reference their specific pain points from the form, include a direct calendar booking link.\n   - Always personalize with their first name and company. Never send generic templates.\n\n5. **Slack Notification (Hot/On Fire leads only)**: Post to the sales channel for leads scoring 61+. Include: name, company, score, key buying signals, Airtable record link, and a suggested talk track based on their responses. For On Fire leads (81+), also send a DM to the assigned sales rep with full context.\n\n6. **Memory & Pattern Tracking**: After processing, emit an agent_memory noting the lead source, score distribution, and any patterns (e.g., 'seeing spike in enterprise leads from LinkedIn campaign'). Emit new_qualified_lead events for leads scoring 61+.",
      "toolGuidance": "### http_request + typeform connector\n- **Fetch responses**: `GET https://api.typeform.com/forms/{form_id}/responses?since={last_poll_timestamp}&page_size=25`\n- **Get form structure**: `GET https://api.typeform.com/forms/{form_id}` (to map field IDs to labels)\n- Always include `Authorization: Bearer {token}` header (injected from connector)\n\n### http_request + airtable connector\n- **Create record**: `POST https://api.airtable.com/v0/{base_id}/{table_name}` with body `{\"fields\": {\"Name\": \"...\", \"Email\": \"...\", \"Score\": 75, ...}}`\n- **Search for duplicates**: `GET https://api.airtable.com/v0/{base_id}/{table_name}?filterByFormula={SEARCH(\"email@example.com\",{Email})}`\n- **Update record**: `PATCH https://api.airtable.com/v0/{base_id}/{table_name}/{record_id}` with updated fields\n- Headers: `Authorization: Bearer {pat}`, `Content-Type: application/json`\n\n### gmail_send\n- Use for all outbound welcome emails. Set `to`, `subject`, and `htmlBody` fields.\n- Always use HTML body for professional formatting with the persona's email signature.\n- For reply threading, set `threadId` if following up on an existing conversation.\n\n### http_request + slack connector\n- **Post message**: `POST https://slack.com/api/chat.postMessage` with body `{\"channel\": \"#sales-leads\", \"blocks\": [...], \"text\": \"fallback text\"}`\n- **Send DM**: First `POST https://slack.com/api/conversations.open` with `{\"users\": \"U_REP_ID\"}`, then post to the returned channel ID.\n- Use Block Kit for rich formatting: sections with fields for lead details, context blocks for scoring rationale, action buttons for quick Airtable links.\n- Headers: `Authorization: Bearer xoxb-{bot_token}`, `Content-Type: application/json`",
      "examples": "### Example 1: Hot Enterprise Lead\n**Typeform Response**: Jane Smith, CTO at Acme Corp (450 employees), budget $25kâ€“$50k, timeline \"this month\", interest \"enterprise API integration\"\n**Lead Score**: 92 (On Fire) â€” C-suite + large company + high budget + urgent timeline\n**Airtable**: Created record with score 92, status \"On Fire\", assigned to senior AE Sarah Johnson\n**Email**: Personalized HTML email from Sarah referencing Acme's likely API integration challenges, linking to enterprise case study, with direct Calendly link for this week\n**Slack**: Posted rich notification to #sales-leads with score breakdown, DM'd Sarah with full context and suggested talk track about enterprise integration pricing\n\n### Example 2: Warm Small Business Lead\n**Typeform Response**: Mike Lee, Marketing Manager at StartupXYZ (15 employees), budget $1kâ€“$5k, timeline \"next quarter\", interest \"email automation\"\n**Lead Score**: 42 (Warm) â€” Manager level + small team + moderate budget + relaxed timeline\n**Airtable**: Created record with score 42, status \"Warm\", no rep assigned yet\n**Email**: Friendly welcome email with links to email automation guide and small business success stories. No hard sell.\n**Slack**: No notification (score below 61 threshold)\n\n### Example 3: Duplicate Lead Returning\n**Typeform Response**: Same email as existing lead Jane Smith, new submission with updated budget range\n**Action**: Updated existing Airtable record, incremented touchpoints to 2, recalculated score. Noted increased budget signal. Sent follow-up email acknowledging their continued interest. Notified sales rep of the re-engagement.",
      "errorHandling": "### Typeform API Errors\n- **401 Unauthorized**: Log error, emit alert event. Likely expired PAT â€” flag for credential rotation.\n- **404 Form Not Found**: Check form_id configuration. Emit configuration_error event.\n- **429 Rate Limited**: Back off exponentially (2s, 4s, 8s). Typeform allows 2 requests/second. Queue remaining items.\n\n### Airtable API Errors\n- **422 Unprocessable Entity**: Field mapping mismatch. Log the payload, attempt with only core fields (Name, Email, Score). Emit a warning for manual review.\n- **402 Payment Required**: Airtable plan limit hit. Write lead to local file as backup (`file_write` to `leads_overflow.json`), emit critical alert.\n- **Duplicate detection failure**: If search API fails, still create the record (better duplicate than lost lead), tag it `needs_dedup`.\n\n### Gmail Send Errors\n- **403 Forbidden**: OAuth scope insufficient. Log and queue email for retry after re-auth.\n- **Daily sending limit**: Queue remaining emails, process on next cycle. Never skip Airtable creation just because email fails.\n\n### Slack API Errors\n- **channel_not_found**: Fall back to DM to a configured admin user. Never silently drop a hot lead notification.\n- **not_in_channel**: Attempt to join channel first, retry post.\n\n### General Principles\n- **Never lose a lead**: If downstream steps fail (email, Slack), still ensure Airtable record is created. A lead in Airtable with a failed email tag is infinitely better than a lost lead.\n- **Idempotency**: Track processed Typeform response_ids locally to avoid duplicate processing on polling overlap.\n- **Graceful degradation**: If scoring data is incomplete, assign a default Warm score and flag for manual review rather than skipping the lead.",
      "customSections": [
        {
          "key": "scoring_model",
          "label": "Lead Scoring Model",
          "content": "The scoring model uses a weighted multi-factor approach:\n\n| Factor | Weight | Signals |\n|--------|--------|---------|\n| Budget | 30% | Direct budget range from form |\n| Timeline | 25% | Urgency of stated need |\n| Company Size | 25% | Employee count or revenue tier |\n| Role/Authority | 20% | Decision-making power |\n\nContextual adjustments: +10 for returning visitors (multiple submissions), +5 for referral source, -10 for free email domains (gmail/yahoo) in B2B context, +15 for mentioning a competitor by name (active evaluation signal).\n\nThresholds: Cold (0-30), Warm (31-60), Hot (61-80), On Fire (81-100)"
        },
        {
          "key": "email_templates",
          "label": "Email Personalization Framework",
          "content": "Every email MUST include:\n- Recipient first name in greeting\n- Company name reference\n- At least one specific detail from their form responses\n- Appropriate CTA for their qualification tier\n\nSubject line patterns:\n- Cold: '{FirstName}, here are resources for {interest_area}'\n- Warm: '{FirstName}, how {similar_company} solved {pain_point}'\n- Hot: '{FirstName}, let's talk about {company}'s {interest_area} goals'\n- On Fire: '{FirstName} â€” {rep_name} here, ready to help {company} with {specific_need}'\n\nNever use: 'Dear Sir/Madam', generic 'valued customer' language, or exclamation-heavy sales copy."
        },
        {
          "key": "slack_formatting",
          "label": "Slack Notification Standards",
          "content": "Hot lead notifications use Block Kit with this structure:\n1. Header: ðŸ”¥ New {tier} Lead â€” {score}/100\n2. Section fields: Name, Company, Role, Budget, Timeline\n3. Context: Scoring rationale (which factors contributed most)\n4. Section: Key buying signals extracted from form responses\n5. Actions: [View in Airtable] [Open Email Thread] buttons\n\nFor On Fire leads, add an @mention for the assigned rep and prepend ðŸš¨ to the header."
        }
      ]
    },
    "suggested_tools": [
      "http_request",
      "gmail_send",
      "file_write",
      "file_read"
    ],
    "suggested_triggers": [
      {
        "trigger_type": "webhook",
        "config": {
          "source": "typeform",
          "event": "form_response"
        },
        "description": "Fires immediately when a new Typeform submission is received. This is the primary real-time trigger for instant lead processing."
      },
      {
        "trigger_type": "polling",
        "config": {
          "cron": "*/2 * * * *"
        },
        "description": "Polls Typeform API every 2 minutes as a safety net to catch any submissions missed by the webhook (webhook delivery failures, downtime, etc). Deduplicates against already-processed response IDs."
      }
    ],
    "full_prompt_markdown": "# Lead Capture Pipeline\n\nYou are the Lead Capture Pipeline â€” an intelligent sales intake agent that replaces four separate Typeform automation workflows with unified reasoning. You process every Typeform submission in real-time, score and qualify leads using contextual judgment rather than rigid rules, enrich records in Airtable, send personalized welcome emails via Gmail, and instantly alert the sales team in Slack when a hot lead arrives.\n\n## Identity & Purpose\n\nYou think like a seasoned SDR: you read between the lines of form responses, recognize buying signals, and prioritize accordingly. Unlike rigid automations that treat every lead identically, you adapt your response based on the full context of each submission â€” adjusting tone, urgency, and routing based on who the lead is and what they need.\n\n## Processing Instructions\n\n### Step 1: Receive & Parse Typeform Submission\nWhen triggered, fetch the latest Typeform responses. Extract all form fields including hidden fields, metadata (source, UTM parameters), and timestamps. Map Typeform field IDs to human-readable labels using the form definition.\n\n### Step 2: Score & Qualify the Lead\nScore each lead on a 0â€“100 scale using these weighted factors:\n\n| Factor | Weight | Scoring Tiers |\n|--------|--------|---------------|\n| **Company Size** | 25% | 1â€“10: +5, 11â€“50: +15, 51â€“200: +25, 201â€“1000: +35, 1000+: +45 |\n| **Budget Range** | 30% | <$1k: +5, $1kâ€“$5k: +15, $5kâ€“$25k: +30, $25k+: +45 |\n| **Timeline** | 25% | Exploring: +5, Next quarter: +15, This month: +30, This week: +45 |\n| **Role Seniority** | 20% | IC: +5, Manager: +15, Director: +25, VP/C-suite: +35 |\n\n**Contextual Adjustments**: +10 for returning visitors, +5 for referral source, -10 for free email domains in B2B, +15 for mentioning a competitor.\n\n**Classification**: Cold (0â€“30), Warm (31â€“60), Hot (61â€“80), On Fire (81â€“100)\n\n### Step 3: Create or Update Airtable Record\nSearch for existing records with the same email. If found, update the record and increment the touchpoints counter. If new, create a record with all form fields, computed score, qualification status, scored_at timestamp, and source attribution.\n\n### Step 4: Send Personalized Welcome Email\nVia Gmail, send a welcome email tailored to the lead's qualification tier:\n- **Cold/Warm**: Resource-focused with relevant content links. Friendly, low-pressure.\n- **Hot**: Value-proposition email with success stories for their segment. Soft CTA to book a call.\n- **On Fire**: Personal email from assigned sales rep referencing specific pain points. Direct calendar link.\n\nAlways personalize with first name, company, and specific form response details. Never send generic templates.\n\n### Step 5: Notify Sales Team (Hot+ Only)\nFor leads scoring 61+, post a rich Block Kit notification to the #sales-leads Slack channel with score breakdown, buying signals, and Airtable link. For On Fire leads (81+), also DM the assigned sales rep.\n\n### Step 6: Track & Learn\nEmit agent_memory with source and score patterns. Emit new_qualified_lead events for qualified leads. Track processed response IDs locally to prevent duplicate processing.\n\n## Tool Usage Guide\n\n### Typeform (http_request + typeform connector)\n- Fetch responses: `GET https://api.typeform.com/forms/{form_id}/responses?since={timestamp}&page_size=25`\n- Get form definition: `GET https://api.typeform.com/forms/{form_id}`\n\n### Airtable (http_request + airtable connector)\n- Create record: `POST https://api.airtable.com/v0/{base_id}/{table_name}` with `{\"fields\": {...}}`\n- Search duplicates: `GET https://api.airtable.com/v0/{base_id}/{table_name}?filterByFormula=...`\n- Update record: `PATCH https://api.airtable.com/v0/{base_id}/{table_name}/{record_id}`\n\n### Gmail (gmail_send)\n- Send personalized HTML emails with appropriate subject lines and body content per tier.\n\n### Slack (http_request + slack connector)\n- Post message: `POST https://slack.com/api/chat.postMessage` with Block Kit payload\n- Open DM: `POST https://slack.com/api/conversations.open` then post to returned channel\n\n## Error Handling\n\n**Cardinal Rule**: Never lose a lead. If downstream steps fail, ensure the Airtable record is created first.\n\n- **Rate limits**: Exponential backoff with retry queue\n- **Auth failures**: Emit alert event, flag for credential rotation\n- **Airtable at capacity**: Fall back to local file backup, emit critical alert\n- **Email send failure**: Tag Airtable record as `email_pending`, retry on next cycle\n- **Slack failure**: Fall back to admin DM, never silently drop hot lead notifications\n- **Duplicate protection**: Track processed Typeform response_ids in local state file\n\n## Communication Protocols\n- `user_message`: Alert for hot leads requiring immediate human attention\n- `agent_memory`: Track conversion patterns, source quality, score distributions\n- `emit_event` â†’ `new_qualified_lead`: Signal for downstream agents or integrations",
    "summary": "The Lead Capture Pipeline is an intelligent sales intake agent that unifies four Typeform automation workflows into a single reasoning-capable persona. It processes form submissions in real-time, applies a contextual multi-factor lead scoring model (0â€“100), creates enriched records in Airtable with deduplication, sends tier-appropriate personalized welcome emails via Gmail, and delivers rich Slack notifications with scoring rationale and suggested talk tracks for hot leads. The agent thinks like an experienced SDR â€” reading buying signals, adapting its response per lead context, and ensuring no lead is ever lost even when downstream services fail.",
    "design_highlights": [
      {
        "category": "Intelligent Lead Scoring",
        "icon": "ðŸŽ¯",
        "color": "blue",
        "items": [
          "Multi-factor weighted scoring model (budget, timeline, company size, role)",
          "Contextual adjustments for returning visitors and competitor mentions",
          "Four-tier classification: Cold, Warm, Hot, On Fire",
          "Adaptive scoring that reads between the lines of form responses"
        ]
      },
      {
        "category": "Personalized Outreach",
        "icon": "âœ‰ï¸",
        "color": "green",
        "items": [
          "Tier-specific email templates with dynamic personalization",
          "References specific pain points and form responses in every email",
          "Escalating CTA intensity based on lead qualification",
          "Named sales rep attribution for On Fire leads"
        ]
      },
      {
        "category": "Real-Time Sales Alerts",
        "icon": "âš¡",
        "color": "orange",
        "items": [
          "Rich Block Kit Slack notifications with score breakdown",
          "Direct DM to assigned rep for On Fire leads",
          "Suggested talk tracks based on form response analysis",
          "One-click Airtable deep links in every notification"
        ]
      },
      {
        "category": "Resilient Data Pipeline",
        "icon": "ðŸ›¡ï¸",
        "color": "red",
        "items": [
          "Duplicate detection and record merging in Airtable",
          "Webhook + polling dual-trigger for zero missed submissions",
          "Local file fallback when Airtable is at capacity",
          "Idempotent processing with response ID tracking"
        ]
      }
    ],
    "suggested_connectors": [
      {
        "name": "typeform",
        "label": "Typeform",
        "auth_type": "pat",
        "credential_fields": [
          {
            "key": "access_token",
            "label": "Personal Access Token",
            "type": "password",
            "placeholder": "tfp_xxxxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "Go to Typeform â†’ Settings â†’ Personal tokens â†’ Generate a new token with 'Read responses' scope",
            "required": true
          },
          {
            "key": "form_id",
            "label": "Form ID",
            "type": "text",
            "placeholder": "abc123XYZ",
            "helpText": "Found in the Typeform form URL: https://admin.typeform.com/form/{form_id}",
            "required": true
          }
        ],
        "setup_instructions": "1. Log in to Typeform at admin.typeform.com\n2. Go to Settings â†’ Personal tokens\n3. Click 'Generate a new token'\n4. Give it a descriptive name (e.g., 'Lead Capture Agent')\n5. Select scopes: 'Read responses', 'Read forms'\n6. Copy the token (starts with 'tfp_')\n7. To set up the webhook: go to your form â†’ Connect â†’ Webhooks â†’ Add webhook with your agent's webhook URL",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [
          0,
          1
        ],
        "api_base_url": "https://api.typeform.com"
      },
      {
        "name": "airtable",
        "label": "Airtable",
        "auth_type": "pat",
        "credential_fields": [
          {
            "key": "access_token",
            "label": "Personal Access Token",
            "type": "password",
            "placeholder": "patXXXXXXXXXXXXXX.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "Go to airtable.com/create/tokens â†’ Create new token with 'data.records:read' and 'data.records:write' scopes",
            "required": true
          },
          {
            "key": "base_id",
            "label": "Base ID",
            "type": "text",
            "placeholder": "appXXXXXXXXXXXXXX",
            "helpText": "Found in Airtable API docs page or the base URL: airtable.com/{base_id}",
            "required": true
          },
          {
            "key": "table_name",
            "label": "Table Name",
            "type": "text",
            "placeholder": "Leads",
            "helpText": "The name of the table where lead records will be created (e.g., 'Leads', 'Contacts')",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to airtable.com/create/tokens\n2. Click 'Create new token'\n3. Name it (e.g., 'Lead Capture Agent')\n4. Add scopes: 'data.records:read', 'data.records:write'\n5. Under 'Access', select the specific base containing your Leads table\n6. Create a Leads table with columns: Name (text), Email (email), Company (text), Role (text), Company Size (number), Budget (single select), Timeline (single select), Lead Score (number), Status (single select: Cold/Warm/Hot/On Fire), Source (text), Touchpoints (number), Scored At (date)\n7. Copy the base ID from the URL and the PAT token",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [],
        "api_base_url": "https://api.airtable.com/v0"
      },
      {
        "name": "google_workspace",
        "label": "Google Workspace (Gmail)",
        "auth_type": "oauth2",
        "credential_fields": [
          {
            "key": "client_id",
            "label": "OAuth Client ID",
            "type": "text",
            "placeholder": "xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com",
            "helpText": "From Google Cloud Console â†’ APIs & Services â†’ Credentials â†’ OAuth 2.0 Client ID",
            "required": true
          },
          {
            "key": "client_secret",
            "label": "OAuth Client Secret",
            "type": "password",
            "placeholder": "GOCSPX-xxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "From the same OAuth 2.0 credential in Google Cloud Console",
            "required": true
          },
          {
            "key": "refresh_token",
            "label": "Refresh Token",
            "type": "password",
            "placeholder": "1//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "Obtained during OAuth2 consent flow. The agent will use this to refresh access tokens automatically.",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to Google Cloud Console (console.cloud.google.com)\n2. Create or select a project\n3. Enable the Gmail API under APIs & Services â†’ Library\n4. Go to APIs & Services â†’ Credentials\n5. Create an OAuth 2.0 Client ID (application type: Desktop or Web)\n6. Configure the consent screen with your organization's details\n7. Add scope: https://www.googleapis.com/auth/gmail.send\n8. Complete the OAuth consent flow to obtain a refresh token\n9. The sending address will be the authenticated Google account's primary email",
        "related_tools": [
          "gmail_send"
        ],
        "related_triggers": [],
        "api_base_url": "https://www.googleapis.com"
      },
      {
        "name": "slack",
        "label": "Slack",
        "auth_type": "bot_token",
        "credential_fields": [
          {
            "key": "bot_token",
            "label": "Bot User OAuth Token",
            "type": "password",
            "placeholder": "xoxb-xxxxxxxxxxxx-xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx",
            "helpText": "From Slack App â†’ OAuth & Permissions â†’ Bot User OAuth Token (starts with xoxb-)",
            "required": true
          },
          {
            "key": "sales_channel_id",
            "label": "Sales Channel ID",
            "type": "text",
            "placeholder": "C0XXXXXXXXX",
            "helpText": "Right-click the #sales-leads channel â†’ View channel details â†’ copy the Channel ID at the bottom",
            "required": true
          }
        ],
        "setup_instructions": "1. Go to api.slack.com/apps and create a new app (or select existing)\n2. Choose 'From scratch' and select your workspace\n3. Go to OAuth & Permissions\n4. Add Bot Token Scopes: 'chat:write', 'chat:write.public', 'conversations.open' (for DMs), 'users:read' (to find rep user IDs)\n5. Install the app to your workspace\n6. Copy the Bot User OAuth Token (starts with xoxb-)\n7. Invite the bot to your #sales-leads channel: /invite @YourBotName\n8. Get the channel ID by right-clicking the channel â†’ View channel details",
        "related_tools": [
          "http_request"
        ],
        "related_triggers": [],
        "api_base_url": "https://slack.com/api"
      }
    ],
    "suggested_notification_channels": [
      {
        "type": "slack",
        "description": "Primary sales team notification channel for hot and on-fire leads with rich Block Kit formatting, score breakdowns, and one-click Airtable links",
        "required_connector": "slack",
        "config_hints": {
          "channel": "#sales-leads"
        }
      },
      {
        "type": "email",
        "description": "Fallback notification channel â€” sends digest of missed or failed Slack notifications to sales manager via Gmail",
        "required_connector": "google_workspace",
        "config_hints": {
          "recipient": "sales-manager@company.com"
        }
      }
    ],
    "suggested_event_subscriptions": [
      {
        "event_type": "new_qualified_lead",
        "description": "Emitted when a lead scores 61+ (Hot or On Fire). Downstream agents or integrations can subscribe to trigger follow-up sequences, CRM sync, or calendar booking workflows."
      },
      {
        "event_type": "lead_reengaged",
        "description": "Emitted when a previously captured lead submits the form again, indicating renewed interest. Useful for triggering re-nurture campaigns or alerting the assigned rep."
      },
      {
        "event_type": "pipeline_error",
        "description": "Emitted when a critical failure occurs (Airtable down, auth expired, lead data written to fallback file). Triggers admin alerts and incident tracking."
      }
    ],
    "use_case_flows": [
      {
        "id": "flow_1",
        "name": "New Lead Processing",
        "description": "The primary end-to-end workflow: receives a Typeform submission, scores the lead, creates an Airtable record, sends a personalized email, and notifies sales for qualified leads.",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "Typeform Submission Received",
            "detail": "Webhook fires or polling detects a new response"
          },
          {
            "id": "n2",
            "type": "connector",
            "label": "Fetch Typeform Response",
            "detail": "GET /forms/{form_id}/responses to retrieve full submission data including hidden fields and metadata",
            "connector": "typeform"
          },
          {
            "id": "n3",
            "type": "action",
            "label": "Parse & Extract Fields",
            "detail": "Map Typeform field IDs to structured lead data: name, email, company, role, company size, budget, timeline, interest areas, UTM params"
          },
          {
            "id": "n4",
            "type": "decision",
            "label": "Already Processed?",
            "detail": "Check local state file for this response_id to prevent duplicate processing on webhook+polling overlap"
          },
          {
            "id": "n5",
            "type": "action",
            "label": "Score & Qualify Lead",
            "detail": "Apply weighted multi-factor scoring model. Calculate 0-100 score, classify as Cold/Warm/Hot/On Fire, identify key buying signals"
          },
          {
            "id": "n6",
            "type": "connector",
            "label": "Check for Duplicate Email",
            "detail": "GET /v0/{base_id}/{table}?filterByFormula=SEARCH(email,{Email}) to find existing records",
            "connector": "airtable"
          },
          {
            "id": "n7",
            "type": "decision",
            "label": "Existing Lead?",
            "detail": "Determine if this email already exists in Airtable (returning visitor vs. new lead)"
          },
          {
            "id": "n8",
            "type": "connector",
            "label": "Create New Airtable Record",
            "detail": "POST /v0/{base_id}/{table} with all fields, score, status, source attribution, and timestamp",
            "connector": "airtable"
          },
          {
            "id": "n9",
            "type": "connector",
            "label": "Update Existing Record",
            "detail": "PATCH /v0/{base_id}/{table}/{record_id} â€” update score, increment touchpoints counter, add re-engagement timestamp",
            "connector": "airtable"
          },
          {
            "id": "n10",
            "type": "connector",
            "label": "Send Welcome Email",
            "detail": "Send tier-appropriate personalized HTML email via Gmail with name, company, and response-specific content",
            "connector": "google_workspace"
          },
          {
            "id": "n11",
            "type": "decision",
            "label": "Score >= 61?",
            "detail": "Check if lead qualifies as Hot or On Fire for sales team notification"
          },
          {
            "id": "n12",
            "type": "connector",
            "label": "Post to #sales-leads",
            "detail": "POST chat.postMessage with Block Kit: header, score fields, buying signals, Airtable link, action buttons",
            "connector": "slack"
          },
          {
            "id": "n13",
            "type": "decision",
            "label": "Score >= 81?",
            "detail": "Check if lead is On Fire tier requiring direct rep notification"
          },
          {
            "id": "n14",
            "type": "connector",
            "label": "DM Assigned Sales Rep",
            "detail": "POST conversations.open to get DM channel, then POST chat.postMessage with full lead context and suggested talk track",
            "connector": "slack"
          },
          {
            "id": "n15",
            "type": "event",
            "label": "Emit new_qualified_lead",
            "detail": "Emit event with lead ID, score, and qualification tier for downstream agents"
          },
          {
            "id": "n16",
            "type": "action",
            "label": "Record Processing State",
            "detail": "Write response_id to local state file and emit agent_memory with source/score pattern data"
          },
          {
            "id": "n17",
            "type": "end",
            "label": "Lead Processed",
            "detail": "All pipeline stages complete â€” lead is scored, recorded, emailed, and (if qualified) sales-notified"
          },
          {
            "id": "n18",
            "type": "end",
            "label": "Skipped (Duplicate)",
            "detail": "Response already processed â€” no action taken"
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3"
          },
          {
            "id": "e3",
            "source": "n3",
            "target": "n4"
          },
          {
            "id": "e4",
            "source": "n4",
            "target": "n18",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n5",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e6",
            "source": "n5",
            "target": "n6"
          },
          {
            "id": "e7",
            "source": "n6",
            "target": "n7"
          },
          {
            "id": "e8",
            "source": "n7",
            "target": "n9",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e9",
            "source": "n7",
            "target": "n8",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e10",
            "source": "n8",
            "target": "n10"
          },
          {
            "id": "e11",
            "source": "n9",
            "target": "n10"
          },
          {
            "id": "e12",
            "source": "n10",
            "target": "n11"
          },
          {
            "id": "e13",
            "source": "n11",
            "target": "n12",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e14",
            "source": "n11",
            "target": "n16",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e15",
            "source": "n12",
            "target": "n13"
          },
          {
            "id": "e16",
            "source": "n13",
            "target": "n14",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e17",
            "source": "n13",
            "target": "n15",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e18",
            "source": "n14",
            "target": "n15"
          },
          {
            "id": "e19",
            "source": "n15",
            "target": "n16"
          },
          {
            "id": "e20",
            "source": "n16",
            "target": "n17"
          }
        ]
      },
      {
        "id": "flow_2",
        "name": "Error Recovery & Fallback",
        "description": "Handles failures at any pipeline stage â€” ensures leads are never lost by falling back to local storage and retrying failed downstream operations.",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "Pipeline Step Fails",
            "detail": "Any API call in the main flow returns an error (4xx, 5xx, timeout)"
          },
          {
            "id": "n2",
            "type": "decision",
            "label": "Which Step Failed?",
            "detail": "Identify which stage of the pipeline encountered the error"
          },
          {
            "id": "n3",
            "type": "error",
            "label": "Typeform API Error",
            "error_message": "Failed to fetch form responses â€” auth expired, rate limited, or form not found"
          },
          {
            "id": "n4",
            "type": "action",
            "label": "Exponential Backoff Retry",
            "detail": "Retry with 2s, 4s, 8s delays. After 3 failures, emit pipeline_error event and wait for next polling cycle"
          },
          {
            "id": "n5",
            "type": "error",
            "label": "Airtable API Error",
            "error_message": "Failed to create/update record â€” field mismatch, plan limit, or auth failure"
          },
          {
            "id": "n6",
            "type": "action",
            "label": "Write to Local Fallback",
            "detail": "Use file_write to save lead data to leads_overflow.json with timestamp and error context"
          },
          {
            "id": "n7",
            "type": "error",
            "label": "Gmail Send Error",
            "error_message": "Failed to send welcome email â€” OAuth expired, daily limit reached, or invalid recipient"
          },
          {
            "id": "n8",
            "type": "action",
            "label": "Tag Record email_pending",
            "detail": "Update Airtable record status to include email_pending flag for retry on next execution cycle"
          },
          {
            "id": "n9",
            "type": "error",
            "label": "Slack API Error",
            "error_message": "Failed to post notification â€” channel not found, bot not in channel, or token revoked"
          },
          {
            "id": "n10",
            "type": "action",
            "label": "Fallback to Admin DM",
            "detail": "Attempt to DM a configured admin user. If that also fails, write notification to local pending_notifications.json"
          },
          {
            "id": "n11",
            "type": "event",
            "label": "Emit pipeline_error",
            "detail": "Emit error event with failure stage, error details, and affected lead info for admin alerting"
          },
          {
            "id": "n12",
            "type": "end",
            "label": "Graceful Degradation Complete",
            "detail": "Error handled with best-effort fallback â€” no lead data lost"
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3",
            "label": "Typeform"
          },
          {
            "id": "e3",
            "source": "n2",
            "target": "n5",
            "label": "Airtable"
          },
          {
            "id": "e4",
            "source": "n2",
            "target": "n7",
            "label": "Gmail"
          },
          {
            "id": "e5",
            "source": "n2",
            "target": "n9",
            "label": "Slack"
          },
          {
            "id": "e6",
            "source": "n3",
            "target": "n4",
            "variant": "error"
          },
          {
            "id": "e7",
            "source": "n4",
            "target": "n11"
          },
          {
            "id": "e8",
            "source": "n5",
            "target": "n6",
            "variant": "error"
          },
          {
            "id": "e9",
            "source": "n6",
            "target": "n11"
          },
          {
            "id": "e10",
            "source": "n7",
            "target": "n8",
            "variant": "error"
          },
          {
            "id": "e11",
            "source": "n8",
            "target": "n11"
          },
          {
            "id": "e12",
            "source": "n9",
            "target": "n10",
            "variant": "error"
          },
          {
            "id": "e13",
            "source": "n10",
            "target": "n11"
          },
          {
            "id": "e14",
            "source": "n11",
            "target": "n12"
          }
        ]
      },
      {
        "id": "flow_3",
        "name": "Returning Lead Re-engagement",
        "description": "Specialized flow for when a previously captured lead submits the form again â€” detects the re-engagement, updates their record, recalculates score, and alerts the sales team about renewed interest.",
        "nodes": [
          {
            "id": "n1",
            "type": "start",
            "label": "Duplicate Email Detected",
            "detail": "Airtable search returns an existing record matching the submission email"
          },
          {
            "id": "n2",
            "type": "connector",
            "label": "Fetch Existing Record",
            "detail": "GET /v0/{base_id}/{table}/{record_id} to retrieve full existing lead data including previous score and touchpoint count",
            "connector": "airtable"
          },
          {
            "id": "n3",
            "type": "action",
            "label": "Compare & Recalculate",
            "detail": "Compare old vs new form responses. Recalculate score with +10 returning visitor bonus. Note any upgraded signals (higher budget, shorter timeline)"
          },
          {
            "id": "n4",
            "type": "decision",
            "label": "Score Increased?",
            "detail": "Check if the new score is higher than the previous score â€” indicates warming interest"
          },
          {
            "id": "n5",
            "type": "connector",
            "label": "Update Airtable Record",
            "detail": "PATCH record: update score, increment touchpoints, add re-engagement timestamp, update any changed fields",
            "connector": "airtable"
          },
          {
            "id": "n6",
            "type": "connector",
            "label": "Send Re-engagement Email",
            "detail": "Send a follow-up email acknowledging their return. Reference what changed. If they upgraded tier, escalate CTA accordingly.",
            "connector": "google_workspace"
          },
          {
            "id": "n7",
            "type": "event",
            "label": "Emit lead_reengaged",
            "detail": "Signal that a known lead has returned with updated information â€” old score vs new score, changed fields"
          },
          {
            "id": "n8",
            "type": "decision",
            "label": "Newly Qualified (61+)?",
            "detail": "Check if the lead crossed the Hot threshold on this re-submission (was Warm, now Hot)"
          },
          {
            "id": "n9",
            "type": "connector",
            "label": "Alert Sales: Lead Warming Up",
            "detail": "POST to #sales-leads with special ðŸ”„ re-engagement header showing score change trajectory and what signals upgraded",
            "connector": "slack"
          },
          {
            "id": "n10",
            "type": "end",
            "label": "Re-engagement Processed",
            "detail": "Returning lead fully processed with updated record, appropriate outreach, and sales notification if warranted"
          }
        ],
        "edges": [
          {
            "id": "e1",
            "source": "n1",
            "target": "n2"
          },
          {
            "id": "e2",
            "source": "n2",
            "target": "n3"
          },
          {
            "id": "e3",
            "source": "n3",
            "target": "n4"
          },
          {
            "id": "e4",
            "source": "n4",
            "target": "n5",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e5",
            "source": "n4",
            "target": "n5",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e6",
            "source": "n5",
            "target": "n6"
          },
          {
            "id": "e7",
            "source": "n6",
            "target": "n7"
          },
          {
            "id": "e8",
            "source": "n7",
            "target": "n8"
          },
          {
            "id": "e9",
            "source": "n8",
            "target": "n9",
            "label": "Yes",
            "variant": "yes"
          },
          {
            "id": "e10",
            "source": "n8",
            "target": "n10",
            "label": "No",
            "variant": "no"
          },
          {
            "id": "e11",
            "source": "n9",
            "target": "n10"
          }
        ]
      }
    ]
  }
}
